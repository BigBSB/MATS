
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MATS &#8212; MATS 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
<script>
$(document).ready(function(){
  // Mark external (non-nist.gov) A tags with class "external"
  //If the adress start with https and ends with nist.gov
  var re_nist = new RegExp('^https?:\/\/((^\/)*\.)*nist\\.gov(\/|$)');
  //Regex to find address that start with https
  var re_absolute_address = new RegExp('^((https?:)?\/\/)');
  $("a").each(function(){
    var url=$(this).attr('href');
    if(re_nist.test(url) || !re_absolute_address.test(url)){
      $(this).addClass('local');
    }else{
      //This a href appears to be external, so tag it
      $(this).addClass('external');
    }
  });
  // Add leaveNotice to external A elements
  $('a.external').leaveNotice();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MATS 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MATS</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for MATS</h1><div class="highlight"><pre>
<span></span><span class="c1">#Import Packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">qgrid</span>
<span class="kn">from</span> <span class="nn">lmfit</span> <span class="kn">import</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">Minimizer</span>
<span class="c1">#import seaborn and set display properties</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;ticks&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;poster&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">hapi</span> <span class="kn">import</span> <span class="n">EnvironmentDependency_Intensity</span><span class="p">,</span> <span class="n">PYTIPS2017</span><span class="p">,</span> <span class="n">molecularMass</span><span class="p">,</span> <span class="n">pcqsdhc</span><span class="p">,</span> <span class="n">ISO</span>


<div class="viewcode-block" id="HTP_from_DF_select"><a class="viewcode-back" href="../MATS.html#MATS.HTP_from_DF_select">[docs]</a><span class="k">def</span> <span class="nf">HTP_from_DF_select</span><span class="p">(</span><span class="n">linelist</span><span class="p">,</span> <span class="n">waves</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">wing_wavenumbers</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{},</span> 
                <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="p">{},</span>  <span class="n">Diluent</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates the absorbance (ppm/cm) based on input line list, wavenumbers, and spectrum environmental parameters.</span>
<span class="sd">    </span>
<span class="sd">    Outline</span>
<span class="sd">    </span>
<span class="sd">    1.  Uses provided wavenumber axis</span>
<span class="sd">    </span>
<span class="sd">    2.  Calculates the molecular density from pressure and temperature</span>
<span class="sd">    </span>
<span class="sd">    3.  Sets up Diluent dictionary if not given as input</span>
<span class="sd">    </span>
<span class="sd">    4.  Calculates line intensity and doppler width at temperature for all lines</span>
<span class="sd">    </span>
<span class="sd">    5.  Loops through each line in the line list and loops through each diluent, generating a line parameter at experimental conditions</span>
<span class="sd">        that is the appropriate ratio of each diluent species corrected for pressure and temperature.  For each line, simulate the line for the given simulation cutoffs and add to cross section</span>
<span class="sd">    </span>
<span class="sd">    6.  Return wavenumber and cross section arrays </span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    linelist : dataframe</span>
<span class="sd">        Pandas dataframe with the following column headers, where species corresponds to each diluent in the spectrum objects included in the dataset and nominal temperature corresponds to the nominal temperatures included in the dataset:</span>
<span class="sd">            nu = wavenumber of the spectral line transition (cm-1) in vacuum</span>
<span class="sd">            </span>
<span class="sd">            sw = The spectral line intensity (cm−1/(molecule⋅cm−2)) at Tref=296K</span>
<span class="sd">            </span>
<span class="sd">            elower = The lower-state energy of the transition (cm-1)</span>
<span class="sd">            </span>
<span class="sd">            molec_id = HITRAN molecular ID number</span>
<span class="sd">            </span>
<span class="sd">            local_iso_id = HITRAN isotopologue ID number</span>
<span class="sd">            </span>
<span class="sd">            gamma_0_species = half width at half maximum (HWHM) (cm−1/atm) at Tref=296K and reference pressure pref=1atm for a given diluent (air, self, CO2, etc.)</span>
<span class="sd">            </span>
<span class="sd">            n_gamma0_species = The coefficient of the temperature dependence of the half width</span>
<span class="sd">            </span>
<span class="sd">            delta_0_species = The pressure shift (cm−1/atm) at Tref=296K and pref=1atm of the line position with respect to the vacuum transition wavenumber νij</span>
<span class="sd">            </span>
<span class="sd">            n_delta0_species = the coefficient of the temperature dependence of the pressure shift</span>
<span class="sd">            </span>
<span class="sd">            SD_gamma_species = the ratio of the speed dependent width to the half-width at reference temperature and pressure</span>
<span class="sd">            </span>
<span class="sd">            n_gamma2_species = the coefficient of the temperature dependence of the speed dependent width NOTE: This is the temperature dependence of the speed dependent width not the ratio of the speed dependence to the half-width</span>
<span class="sd">            </span>
<span class="sd">            SD_delta_species = the ratio of the speed dependent shift to the collisional shift at reference temperature and pressure</span>
<span class="sd">            </span>
<span class="sd">            n_delta2_species = the coefficient of the temperature dependence of the speed dependent shift NOTE: This is the temperature dependence of the speed dependent shift not the ratio of the speed dependence to the shift</span>
<span class="sd">            </span>
<span class="sd">            nuVC_species = dicke narrowing term at reference temperature</span>
<span class="sd">            </span>
<span class="sd">            n_nuVC_species = coefficient of the temperature dependence of the dicke narrowing term</span>
<span class="sd">            </span>
<span class="sd">            eta_species = the correlation parameter for the VC and SD effects</span>
<span class="sd">            </span>
<span class="sd">            y_species_nominaltemperature = linemixing term (as currently written this doesn&#39;t have a temperature dependence, so read in a different column for each nominal temperature)</span>
<span class="sd">    waves : array</span>
<span class="sd">        1-D array comprised of wavenumbers (cm-1) to use as x-axis for simulation.</span>
<span class="sd">    wing_cutoff : float, optional</span>
<span class="sd">        number of half-widths for each line to be calculated for. The default is 50.</span>
<span class="sd">    wing_wavenumbers : float, optional</span>
<span class="sd">        number of wavenumber for each line to be calculated. The default is 50.</span>
<span class="sd">    wing_method : str, optional</span>
<span class="sd">        defines which wing cut-off option to use.  Options are wing_cutoff or wing_wavenumbers The default is &#39;wing_cutoff&#39;.</span>
<span class="sd">    p : float, optional</span>
<span class="sd">        pressure for simulation in atmospheres. The default is 1.</span>
<span class="sd">    T : float, optional</span>
<span class="sd">        temperature for simulation in kelvin. The default is 296.</span>
<span class="sd">    molefraction : dict, optional</span>
<span class="sd">        takes the form {molecule_id : mole fraction, molecule_id: mole fraction, . . .}. The default is {}.</span>
<span class="sd">    natural_abundance : bool, optional</span>
<span class="sd">        True indicates the sample is at natural abundance. The default is True.</span>
<span class="sd">    abundance_ratio_MI : dictionary, optional</span>
<span class="sd">        If sample is not at natural abundance, then the natural abundance defines the enrichment factor compared to natural abundance(ie a sample where the main isotope is the only isotope would have a 1/natural abundance as the enrichment factor). Defined as {M:{I:enrichment factor, I: enrichment factor, I: enrichment factor}, . . . }. The default is {}.</span>
<span class="sd">    Diluent : dict, optional</span>
<span class="sd">        contains the species as the key with the value being the abundance of that diluent in the sample, ie {&#39;He&#39;:0.5, &#39;self&#39;:0.5}. The default is {}.</span>
<span class="sd">    diluent : str, optional</span>
<span class="sd">        If Diluent = {}, then this value will be used to set the only diluent to be equal to this diluent. The default is &#39;air&#39;.</span>
<span class="sd">    IntensityThreshold : float, optional</span>
<span class="sd">        minimum line intensity that will be simulated. The default is 1e-30.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wavenumbers : array</span>
<span class="sd">        wavenumber axis that should match the input waves</span>
<span class="sd">    xsect : array</span>
<span class="sd">        simulated cross section as a function of wavenumbers (ppm/cm)</span>
<span class="sd">        </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Generate X-axis for simulation</span>
    <span class="n">wavenumbers</span> <span class="o">=</span> <span class="n">waves</span>
        
    <span class="c1">#Set Omegas to X-values</span>
    <span class="n">Xsect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span>
    
    <span class="c1">#define reference temperature/pressure and calculate molecular density</span>
    <span class="n">Tref</span> <span class="o">=</span> <span class="mf">296.</span> <span class="c1"># K</span>
    <span class="n">pref</span> <span class="o">=</span> <span class="mf">1.</span> <span class="c1"># atm</span>
    <span class="n">mol_dens</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mf">9.869233e-7</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.380648813E-16</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> 
    
    <span class="c1">#Sets-up the  Diluent (currently limited to air or self, unless manual input in Diluent)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Diluent</span><span class="p">:</span>
        <span class="n">Diluent</span> <span class="o">=</span> <span class="p">{</span><span class="n">diluent</span><span class="p">:</span><span class="mf">1.</span><span class="p">}</span>

    <span class="c1">#Calculate line intensity</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;SigmaT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;SigmaTref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;GammaD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;abun_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">for</span> <span class="n">molec</span> <span class="ow">in</span> <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">iso</span> <span class="ow">in</span> <span class="n">linelist</span> <span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">linelist</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">molec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">iso</span><span class="p">),</span> <span class="s1">&#39;SigmaT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PYTIPS2017</span><span class="p">(</span><span class="n">molec</span><span class="p">,</span><span class="n">iso</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
            <span class="n">linelist</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">molec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">iso</span><span class="p">),</span> <span class="s1">&#39;SigmaTref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PYTIPS2017</span><span class="p">(</span><span class="n">molec</span><span class="p">,</span><span class="n">iso</span><span class="p">,</span><span class="n">Tref</span><span class="p">)</span>
            <span class="n">linelist</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">molec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">iso</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecularMass</span><span class="p">(</span><span class="n">molec</span><span class="p">,</span><span class="n">iso</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.66053873e-27</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1">#cmassmol and kg conversion</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">natural_abundance</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">abundance_ratio_MI</span> <span class="o">!=</span> <span class="p">{}:</span>
                <span class="n">linelist</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">molec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">iso</span><span class="p">),</span> <span class="s1">&#39;abun_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">abundance_ratio_MI</span><span class="p">[</span><span class="n">molec</span><span class="p">][</span><span class="n">iso</span><span class="p">]</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;LineIntensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnvironmentDependency_Intensity</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">],</span><span class="n">T</span><span class="p">,</span><span class="n">Tref</span><span class="p">,</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;SigmaT&#39;</span><span class="p">],</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;SigmaTref&#39;</span><span class="p">],</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;elower&#39;</span><span class="p">],</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">])</span>
    
    <span class="c1">#Calculate Doppler Broadening</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;GammaD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mf">1.380648813E-16</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.99792458e10</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span>
    <span class="c1"># Calculated Line Parameters across Broadeners</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Gamma0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Shift0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Gamma2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Shift2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;NuVC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">Diluent</span><span class="p">:</span>
        <span class="n">abun</span> <span class="o">=</span> <span class="n">Diluent</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
        <span class="c1">#Gamma0: pressure broadening coefficient HWHM</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Gamma0&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">abun</span><span class="o">*</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;gamma0_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">pref</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">Tref</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;n_gamma0_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]))</span>
        <span class="c1">#Delta0</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Shift0&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">abun</span><span class="o">*</span><span class="p">((</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;delta0_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span> <span class="o">+</span> <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;n_delta0_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">Tref</span><span class="p">))</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="n">pref</span><span class="p">)</span>
        <span class="c1">#Gamma2</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Gamma2&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">abun</span><span class="o">*</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;SD_gamma_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;gamma0_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">pref</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">Tref</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;n_gamma2_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]))</span>
        <span class="c1">#Delta2</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Shift2&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">abun</span><span class="o">*</span><span class="p">((</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;SD_delta_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;delta0_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span> <span class="o">+</span> <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;n_delta2_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">Tref</span><span class="p">))</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="n">pref</span><span class="p">)</span>
        <span class="c1">#nuVC</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;NuVC&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">abun</span><span class="o">*</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;nuVC_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">pref</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">Tref</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;n_nuVC_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">])))</span>
        <span class="c1">#eta</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">abun</span><span class="o">*</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;eta_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span> 
        <span class="c1">#Line mixing</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">abun</span><span class="o">*</span><span class="p">(</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;y_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">pref</span><span class="p">))</span>
    
    <span class="c1">#Line profile simulation cut-off determination    </span>
    <span class="k">if</span> <span class="n">wing_method</span> <span class="o">==</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">:</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;line cut-off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5346</span><span class="o">*</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Gamma0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.2166</span><span class="o">*</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;Gamma0&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;GammaD&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">wing_cutoff</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;line cut-off&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wing_wavenumbers</span>
    
    <span class="c1">#Enforce  Line Intensity Simulation Threshold</span>
    <span class="n">linelist</span> <span class="o">=</span> <span class="n">linelist</span><span class="p">[</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;LineIntensity&#39;</span><span class="p">]</span><span class="o">&gt;=</span> <span class="n">IntensityThreshold</span><span class="p">]</span> 
    
    <span class="c1">#For each line calculate spectrum and add to the global spectrum</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">linelist</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">BoundIndexLower</span> <span class="o">=</span> <span class="n">bisect</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;line cut-off&#39;</span><span class="p">])</span>
        <span class="n">BoundIndexUpper</span> <span class="o">=</span> <span class="n">bisect</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;line cut-off&#39;</span><span class="p">])</span>
        <span class="n">lineshape_vals_real</span><span class="p">,</span> <span class="n">lineshape_vals_imag</span> <span class="o">=</span> <span class="n">pcqsdhc</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;GammaD&#39;</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Gamma0&#39;</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Gamma2&#39;</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Shift0&#39;</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Shift2&#39;</span><span class="p">],</span>
                                                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;NuVC&#39;</span><span class="p">],</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">],</span><span class="n">wavenumbers</span><span class="p">[</span><span class="n">BoundIndexLower</span><span class="p">:</span><span class="n">BoundIndexUpper</span><span class="p">])</span>    
        <span class="n">Xsect</span><span class="p">[</span><span class="n">BoundIndexLower</span><span class="p">:</span><span class="n">BoundIndexUpper</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mol_dens</span>  <span class="o">*</span> \
                                                    <span class="n">molefraction</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;abun_ratio&#39;</span><span class="p">]</span> <span class="o">*</span> \
                                                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;LineIntensity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">lineshape_vals_real</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">lineshape_vals_imag</span><span class="p">)</span> 
    
    <span class="c1"># Return two arrays corresponding to the wavenumber axis and the calculated cross-section                                                                                                      </span>
    <span class="k">return</span> <span class="p">(</span><span class="n">wavenumbers</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Xsect</span><span class="p">))</span>  </div>


<div class="viewcode-block" id="Spectrum"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum">[docs]</a><span class="k">class</span> <span class="nc">Spectrum</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Spectrum class provides all information describing experimental or simulated spectrum.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        file containing spectrum with .csv extension. File extension is not included in the name</span>
<span class="sd">    molefraction : dict</span>
<span class="sd">        mole fraction of each molecule in spectra in the format {molec_id: mole fraction (out of 1), molec_id: molefraction, . . . }</span>
<span class="sd">    natural_abundance : bool, optional</span>
<span class="sd">        flag for if the molecular species in the spectrum are at natural abundance</span>
<span class="sd">    abundance_ratio_MI : dict, optional</span>
<span class="sd">        if not at natural abundance sets the enhancement factor for each molecule and isotope in the following format {molec_id:{iso_id: enhancement, iso_id: enhancement}, . . . }</span>
<span class="sd">    diluent : str, optional</span>
<span class="sd">        sets the diluent for the sample.  Default = &#39;air&#39;</span>
<span class="sd">    Diluent : dict, optional</span>
<span class="sd">        sets the diluent for the sample if there are a combination of several diluents. Format {&#39;he&#39;: 0.5, &#39;air&#39;: 0.5). NOTE: the line parameter file must have parameters that correspond to the diluent (ie gamma0_he, and gamma0_air). Additionally, the contribution from all diluents must sum to 1.</span>
<span class="sd">    spectrum_number : int, optional</span>
<span class="sd">        sets a number for the spectrum that will correspond to fit parameters. This is set in the Dataset class, so should not need to be defined manually</span>
<span class="sd">    input_freq : bool, optional</span>
<span class="sd">        True indicates that the frequency_column is in MHz. False indicates that the frequency column is in wavenumbers.</span>
<span class="sd">    input_tau : bool, optional</span>
<span class="sd">        True indicates that the tau_column is in us. False indicates that the tau column is in 1/c*tau (ppm/cm).</span>
<span class="sd">    pressure_column : str, optional</span>
<span class="sd">        Name of the pressure column in input file. Column should be in torr. Default is Cavity Pressure /Torr.</span>
<span class="sd">    temperature_column : str, optional</span>
<span class="sd">        Name of the temperature column in input file. Column should be in celsius. Default is Cavity Temperature Side 2 /C.</span>
<span class="sd">    frequency_column  : str, optional</span>
<span class="sd">        Name of the frequency column in input file. Column should be in MHz or Wavenumbers (with appropriate flag for input_freq). NOTE: This is not a detuning axis. Default is Total Frequency /MHz.</span>
<span class="sd">    tau_column : str, optional</span>
<span class="sd">        Name of the tau column in input file. Column should be in us or in 1/ctau (ppm/cm) (with appropriate flag for input_tau). Default is Mean tau/us.</span>
<span class="sd">    tau_stats_column  : str, optional</span>
<span class="sd">        Name of the tau stats column in input file. Default is &#39;tau rel. std. dev./%</span>
<span class="sd">    segment_column  : str, optional</span>
<span class="sd">        Name of column with segment numbers in input file. This column allows spectrum background parameters to be treated in segments across the spectrum. If None then the entire spectrum will share the same segment.</span>
<span class="sd">    etalons : dict, optional</span>
<span class="sd">        Allows you to define etalons by an amplitude and period (1/ frequency in cm-1). Default is no etalons. Input is dictionary with keys being a number and the value being an array with the first index being the amplitude and the second being the period.</span>
<span class="sd">    nominal_temperature : int, optional</span>
<span class="sd">        nominal temperature indicates the approximate temperature of the spectrum. When combining spectra into a dataset this acts as a flag to whether temperature dependence terms should be parameters that can be fit or whether they should act as constants.  Default = 296</span>
<span class="sd">    x_shift : float, optional</span>
<span class="sd">        value in wavenumbers of the x shift for the spectrum axis. This is a fittable parameter. Be careful in using this parameter as floating multiple parameters with similar effects cause fits to not converge (ie. unconstrained line centers + x_shift or fits with line center, shifts, and x_shifts terms without enough lines per spectrum to isolate the different effects). Floating this term works best if you have a good initial guess. Default = 0</span>
<span class="sd">    baseline_order : int, optional</span>
<span class="sd">        sets the baseline order for this spectrum. Allows you to change the baseline order across the broader dataset.()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span> <span class="n">Diluent</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">spectrum_number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                    <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                    <span class="n">pressure_column</span> <span class="o">=</span> <span class="s1">&#39;Cavity Pressure /Torr&#39;</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="s1">&#39;Cavity Temperature Side 2 /C&#39;</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="s1">&#39;Total Frequency /MHz&#39;</span><span class="p">,</span> 
                    <span class="n">tau_column</span> <span class="o">=</span> <span class="s1">&#39;Mean tau/us&#39;</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                    <span class="n">etalons</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">baseline_order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molefraction</span> <span class="o">=</span> <span class="n">molefraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natural_abundance</span> <span class="o">=</span> <span class="n">natural_abundance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="n">abundance_ratio_MI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diluent</span> <span class="o">=</span> <span class="n">diluent</span>
        <span class="k">if</span> <span class="n">Diluent</span> <span class="o">==</span> <span class="p">{}:</span> <span class="c1">#if Diluent was not set as the dictionary of various broadeners, then define dictionary with all of the broadening contribution coming from the diluent broadener</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Diluent</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">diluent</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Diluent</span> <span class="o">=</span> <span class="n">Diluent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_number</span> <span class="o">=</span> <span class="n">spectrum_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_column</span> <span class="o">=</span> <span class="n">pressure_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_column</span> <span class="o">=</span> <span class="n">temperature_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_column</span> <span class="o">=</span> <span class="n">frequency_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_column</span> <span class="o">=</span> <span class="n">tau_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">tau_stats_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_column</span> <span class="o">=</span> <span class="n">segment_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_freq</span> <span class="o">=</span> <span class="n">input_freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_tau</span> <span class="o">=</span> <span class="n">input_tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_temperature</span> <span class="o">=</span> <span class="n">nominal_temperature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_shift</span> <span class="o">=</span> <span class="n">x_shift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_order</span> <span class="o">=</span> <span class="n">baseline_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diluent_sum_check</span><span class="p">()</span> <span class="c1"># Makes sure that the diluent contributions sum to 1</span>
        
        <span class="c1">#Defined from contents of file</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span><span class="n">float_precision</span> <span class="o">=</span> <span class="s1">&#39;High&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure_column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="mi">760</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature_column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="mf">273.15</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_freq</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span> <span class="o">/</span> <span class="mi">29979245800</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span><span class="o">*</span><span class="mi">29979245800</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_tau</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">*</span><span class="mf">0.0299792458</span><span class="p">)</span><span class="o">**-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="mf">0.0299792458</span><span class="p">)</span><span class="o">**-</span><span class="mi">1</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats_column</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_stats_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_column</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segments</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
<div class="viewcode-block" id="Spectrum.diluent_sum_check"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.diluent_sum_check">[docs]</a>    <span class="k">def</span> <span class="nf">diluent_sum_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks that if multiple broadeners are used that the contributions sum to one.</span>
<span class="sd">               </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Warning if the diluents don&#39;t sum to one</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">diluent_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dil</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Diluent</span><span class="p">:</span>
            <span class="n">diluent_sum</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">Diluent</span><span class="p">[</span><span class="n">dil</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">diluent_sum</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;YOUR DILUENTS DO NOT SUM TO ONE!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Spectrum.segment_wave_alpha"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.segment_wave_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">segment_wave_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Defines the wavenumber, alpha, and indices of spectrum that correspond to a given spectrum segment.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        wavenumber_segments : dict</span>
<span class="sd">            dictionary where the key corresponds to a segment number and the values correspond to the wavenumbers for that segment</span>
<span class="sd">        alpha_segments : dict</span>
<span class="sd">            dictionary where the key corresponds to a segment number and the values correspond to the alpha values for that segment.</span>
<span class="sd">        indices_segments : dict</span>
<span class="sd">            dictionary where the key corresponds to a segment number and the values correspond to the array indices for that segment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wavenumber_segments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">alpha_segments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">indices_segments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">)):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">segment</span><span class="p">]</span>
            <span class="n">indices_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">indices</span>
            <span class="n">wavenumber_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">alpha_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">wavenumber_segments</span><span class="p">,</span> <span class="n">alpha_segments</span><span class="p">,</span> <span class="n">indices_segments</span></div>
 
    <span class="c1">## GETTERS    </span>
<div class="viewcode-block" id="Spectrum.get_filename"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span></div>
<div class="viewcode-block" id="Spectrum.get_molefraction"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_molefraction">[docs]</a>    <span class="k">def</span> <span class="nf">get_molefraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">molefraction</span></div>
<div class="viewcode-block" id="Spectrum.get_natural_abundance"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_natural_abundance">[docs]</a>    <span class="k">def</span> <span class="nf">get_natural_abundance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">natural_abundance</span></div>
<div class="viewcode-block" id="Spectrum.get_abundance_ratio_MI"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_abundance_ratio_MI">[docs]</a>    <span class="k">def</span> <span class="nf">get_abundance_ratio_MI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abundance_ratio_MI</span></div>
<div class="viewcode-block" id="Spectrum.get_diluent"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_diluent">[docs]</a>    <span class="k">def</span> <span class="nf">get_diluent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diluent</span></div>
<div class="viewcode-block" id="Spectrum.get_Diluent"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_Diluent">[docs]</a>    <span class="k">def</span> <span class="nf">get_Diluent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Diluent</span></div>
<div class="viewcode-block" id="Spectrum.get_spectrum_number"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_spectrum_number">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectrum_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_number</span></div>
<div class="viewcode-block" id="Spectrum.get_pressure"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_pressure">[docs]</a>    <span class="k">def</span> <span class="nf">get_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span></div>
<div class="viewcode-block" id="Spectrum.get_temperature"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span></div>
<div class="viewcode-block" id="Spectrum.get_pressure_torr"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_pressure_torr">[docs]</a>    <span class="k">def</span> <span class="nf">get_pressure_torr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">*</span><span class="mi">760</span></div>
<div class="viewcode-block" id="Spectrum.get_temperature_C"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_temperature_C">[docs]</a>    <span class="k">def</span> <span class="nf">get_temperature_C</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">-</span> <span class="mf">273.15</span></div>
<div class="viewcode-block" id="Spectrum.get_frequency"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span></div>
<div class="viewcode-block" id="Spectrum.get_tau"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_tau">[docs]</a>    <span class="k">def</span> <span class="nf">get_tau</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span></div>
<div class="viewcode-block" id="Spectrum.get_tau_stats"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_tau_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_tau_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats</span></div>
<div class="viewcode-block" id="Spectrum.get_wavenumber"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_wavenumber">[docs]</a>    <span class="k">def</span> <span class="nf">get_wavenumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span></div>
<div class="viewcode-block" id="Spectrum.get_alpha"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">get_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span></div>
<div class="viewcode-block" id="Spectrum.get_etalons"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_etalons">[docs]</a>    <span class="k">def</span> <span class="nf">get_etalons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">etalons</span></div>
<div class="viewcode-block" id="Spectrum.get_model"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_model">[docs]</a>    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span></div>
<div class="viewcode-block" id="Spectrum.get_residuals"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_residuals">[docs]</a>    <span class="k">def</span> <span class="nf">get_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span></div>
<div class="viewcode-block" id="Spectrum.get_background"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_background">[docs]</a>    <span class="k">def</span> <span class="nf">get_background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span></div>
<div class="viewcode-block" id="Spectrum.get_nominal_temperature"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.get_nominal_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_nominal_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nominal_temperature</span></div>

    <span class="c1">##SETTERS </span>
<div class="viewcode-block" id="Spectrum.set_molefraction"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_molefraction">[docs]</a>    <span class="k">def</span> <span class="nf">set_molefraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_molefraction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molefraction</span> <span class="o">=</span> <span class="n">new_molefraction</span></div>
<div class="viewcode-block" id="Spectrum.set_natural_abundance"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_natural_abundance">[docs]</a>    <span class="k">def</span> <span class="nf">set_natural_abundance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_natural_abundance</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natural_abundance</span> <span class="o">=</span> <span class="n">new_natural_abundance</span></div>
<div class="viewcode-block" id="Spectrum.set_abundance_ration_MI"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_abundance_ration_MI">[docs]</a>    <span class="k">def</span> <span class="nf">set_abundance_ration_MI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_abundance_ratio_MI</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="n">new_abundance_ratio_MI</span></div>
<div class="viewcode-block" id="Spectrum.set_diluent"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_diluent">[docs]</a>    <span class="k">def</span> <span class="nf">set_diluent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_diluent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diluent</span> <span class="o">=</span> <span class="n">new_diluent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Diluent</span> <span class="o">=</span> <span class="p">{</span><span class="n">new_diluent</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}</span></div>
<div class="viewcode-block" id="Spectrum.set_Diluent"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_Diluent">[docs]</a>    <span class="k">def</span> <span class="nf">set_Diluent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_Diluent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Diluent</span> <span class="o">=</span> <span class="n">new_Diluent</span></div>
<div class="viewcode-block" id="Spectrum.set_spectrum_number"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_spectrum_number">[docs]</a>    <span class="k">def</span> <span class="nf">set_spectrum_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_spectrum_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_number</span> <span class="o">=</span> <span class="n">new_spectrum_number</span></div>
<div class="viewcode-block" id="Spectrum.set_pressure_column"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_pressure_column">[docs]</a>    <span class="k">def</span> <span class="nf">set_pressure_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_pressure_column</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_column</span> <span class="o">=</span> <span class="n">new_pressure_column</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure_column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="mi">760</span></div>
<div class="viewcode-block" id="Spectrum.set_temperature_column"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_temperature_column">[docs]</a>    <span class="k">def</span> <span class="nf">set_temperature_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_temperature_column</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_colum</span> <span class="o">=</span> <span class="n">new_temperature_column</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature_column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="mf">273.15</span></div>
<div class="viewcode-block" id="Spectrum.set_frequency_column"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_frequency_column">[docs]</a>    <span class="k">def</span> <span class="nf">set_frequency_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_frequency_column</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_column</span> <span class="o">=</span> <span class="n">new_frequency_column</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span> <span class="o">/</span> <span class="mi">29979245800</span></div>
<div class="viewcode-block" id="Spectrum.set_tau_column"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_tau_column">[docs]</a>    <span class="k">def</span> <span class="nf">set_tau_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_tau_column</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_column</span> <span class="o">=</span> <span class="n">new_tau_column</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">*</span><span class="mf">0.0299792458</span><span class="p">)</span><span class="o">**-</span><span class="mi">1</span></div>
<div class="viewcode-block" id="Spectrum.set_tau_stats_column"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_tau_stats_column">[docs]</a>    <span class="k">def</span> <span class="nf">set_tau_stats_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_tau_stats_column</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats_column</span> <span class="o">=</span> <span class="n">new_tau_stats_column</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_stats_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>
<div class="viewcode-block" id="Spectrum.set_etalons"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_etalons">[docs]</a>    <span class="k">def</span> <span class="nf">set_etalons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_etalons</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etalons</span> <span class="o">=</span> <span class="n">new_etalons</span></div>
<div class="viewcode-block" id="Spectrum.set_model"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_model">[docs]</a>    <span class="k">def</span> <span class="nf">set_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">new_model</span></div>
<div class="viewcode-block" id="Spectrum.set_residuals"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_residuals">[docs]</a>    <span class="k">def</span> <span class="nf">set_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_residuals</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="n">new_residuals</span>     </div>
<div class="viewcode-block" id="Spectrum.set_background"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_background">[docs]</a>    <span class="k">def</span> <span class="nf">set_background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_background</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">new_background</span></div>
<div class="viewcode-block" id="Spectrum.set_nominal_temperature"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.set_nominal_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">set_nominal_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_nominal_temperature</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_temperature</span> <span class="o">=</span> <span class="n">new_nominal_temperature</span> </div>

    <span class="c1">##Other Functions</span>
<div class="viewcode-block" id="Spectrum.plot_freq_tau"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.plot_freq_tau">[docs]</a>    <span class="k">def</span> <span class="nf">plot_freq_tau</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a plot of tau (us) as a function of frequency (MHz).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">tau (\mu s)$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Spectrum.plot_wave_alpha"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.plot_wave_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">plot_wave_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a plot of alpha (ppm/cm) as a function of wavenumber (cm-1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavenumber ($cm^{-1}$)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">alpha (</span><span class="se">\\</span><span class="s1">frac</span><span class="si">{ppm}{cm}</span><span class="s1">)$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Spectrum.calculate_QF"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.calculate_QF">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_QF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the quality of fit factor (QF) for a spectrum - QF = (maximum alpha - minimum alpha) / std(residuals).</span>
<span class="sd">            </span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            QF.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Spectrum.plot_model_residuals"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.plot_model_residuals">[docs]</a>    <span class="k">def</span> <span class="nf">plot_model_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a plot of the alpha and model (ppm/cm) as a function of wavenumber (cm-1) and on lower plot shows the residuals (ppm/cm) as a function of wavenumber (cm-1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">QF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
        <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span> <span class="p">)</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="s1">&#39;k.&#39;</span><span class="p">)</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">alpha (</span><span class="se">\\</span><span class="s1">frac</span><span class="si">{ppm}{cm}</span><span class="s1">)$&#39;</span><span class="p">)</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span><span class="s1">&#39;QF: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">QF</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavenumbers ($cm^{-1}$)&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals $(</span><span class="se">\\</span><span class="s1">frac</span><span class="si">{ppm}{cm}</span><span class="s1">)$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Spectrum.save_spectrum_info"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.save_spectrum_info">[docs]</a>    <span class="k">def</span> <span class="nf">save_spectrum_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_file</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves spectrum information to a pandas dataframe with option to also save as as a csv file.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_file : bool, optional</span>
<span class="sd">           If False, then only a dataframe is created. If True, then a csv file will be generated with the name filename + &#39;_saved.csv&#39;. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_file : dataframe</span>
<span class="sd">            returns a pandas dataframe with columns related to the spectrum information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>       
        <span class="n">new_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Spectrum Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Wavenumber (cm-1)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Pressure (Torr)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Tau (us)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Tau Error (%)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_stats</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Alpha (ppm/cm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Model (ppm/cm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Residuals (ppm/cm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;QF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
        <span class="n">new_file</span><span class="p">[</span><span class="s1">&#39;Background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span>
        <span class="k">if</span> <span class="n">save_file</span><span class="p">:</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_saved.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">new_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="Spectrum.fft_spectrum"><a class="viewcode-back" href="../MATS.html#MATS.Spectrum.fft_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">fft_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes the FFT of the residuals of the spectrum, generates a plot of frequency (cm-1) versus amplitude (ppm/cm), and prints a dataframe with the 20 highest amplitude frequencies with the FFT frequency (period), amplitude, FFT phase, and frequency (cm-1).  </span>
<span class="sd">     </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavenumber</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span>
        <span class="n">wave_step</span> <span class="o">=</span> <span class="n">wave</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">fft_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">wave_step</span><span class="p">)</span>
        <span class="n">fft_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
        <span class="n">fft_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">FFT</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">FFT</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fft_freq</span>
        <span class="n">FFT</span><span class="p">[</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fft_amplitude</span>
        <span class="n">FFT</span><span class="p">[</span><span class="s1">&#39;Phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fft_phase</span>
        <span class="n">FFT</span><span class="p">[</span><span class="s1">&#39;Freq (cm-1)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fft_freq</span>
        <span class="n">fft_</span> <span class="o">=</span> <span class="n">FFT</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;any&#39;</span><span class="p">)</span>
        <span class="n">fft_</span> <span class="o">=</span> <span class="p">(</span><span class="n">fft_</span><span class="p">[</span><span class="n">fft_</span><span class="p">[</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e-5</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">fft_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">fft_freq</span><span class="p">,</span> <span class="n">fft_amplitude</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Experimental Wavenumber ($cm^{-1}$)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (ppm/cm&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="Dataset"><a class="viewcode-back" href="../MATS.html#MATS.Dataset">[docs]</a><span class="k">class</span> <span class="nc">Dataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Combines spectrum objects into a Dataset object to enable multi-spectrum fitting.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spectra : list</span>
<span class="sd">        list of spectrum objects to be included in the Dataset. Example [spectrum_1, spectrum_2, . . .]</span>
<span class="sd">    dataset_name : str</span>
<span class="sd">        Used to provide a name for the Dataset to use when saving files</span>
<span class="sd">    baseline_order : int</span>
<span class="sd">        sets the baseline order for all spectra in the dataset.  This will automatically be set to the maximum baseline order across all spectrum included in the Dataset.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">baseline_order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_order</span> <span class="o">=</span> <span class="n">baseline_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renumber_spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correct_component_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correct_etalon_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_baseline_order</span><span class="p">()</span>
        
<div class="viewcode-block" id="Dataset.renumber_spectra"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.renumber_spectra">[docs]</a>    <span class="k">def</span> <span class="nf">renumber_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;renumbers the spectra to be sequential starting at 1 (called in the initialization of the class).</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spectrum</span><span class="o">.</span><span class="n">set_spectrum_number</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span></div>

<div class="viewcode-block" id="Dataset.max_baseline_order"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.max_baseline_order">[docs]</a>    <span class="k">def</span> <span class="nf">max_baseline_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the baseline order to be equal to the maximum in any of the included spectra.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">baseline_order_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">baseline_order_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">baseline_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_order</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">baseline_order_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.correct_component_list"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.correct_component_list">[docs]</a>    <span class="k">def</span> <span class="nf">correct_component_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Corrects so that all spectrum share the same molecules, but the mole fraction is fixed to zero where molecules are not present (called in the initialization of the class). </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset_molecule_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">dataset_molecule_list</span> <span class="o">+=</span> <span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">molefraction</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">dataset_molecule_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dataset_molecule_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spectrum_molefraction_dictionary</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get_molefraction</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">dataset_molecule_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">molecule</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spectrum_molefraction_dictionary</span><span class="p">:</span>
                    <span class="n">spectrum_molefraction_dictionary</span><span class="p">[</span><span class="n">molecule</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">spectrum</span><span class="o">.</span><span class="n">set_molefraction</span><span class="p">(</span><span class="n">spectrum_molefraction_dictionary</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.correct_etalon_list"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.correct_etalon_list">[docs]</a>    <span class="k">def</span> <span class="nf">correct_etalon_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Corrects so that all spectrum share the same number of etalons, but the amplitude and period are fixed to zero where appropriate(called in the initialization of the class). </span>
<span class="sd">          &quot;&quot;&quot;</span>
        <span class="n">dataset_etalon_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">dataset_etalon_list</span> <span class="o">+=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">dataset_etalon_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dataset_etalon_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spectrum_etalon_dictionary</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get_etalons</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">etalon_number</span> <span class="ow">in</span> <span class="n">dataset_etalon_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">etalon_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spectrum_etalon_dictionary</span><span class="p">:</span>
                    <span class="n">spectrum_etalon_dictionary</span><span class="p">[</span><span class="n">etalon_number</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">spectrum</span><span class="o">.</span><span class="n">set_etalons</span><span class="p">(</span><span class="n">spectrum_etalon_dictionary</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.get_etalons"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_etalons">[docs]</a>    <span class="k">def</span> <span class="nf">get_etalons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get list of number of etalons for spectra.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataset_etalon_list : list</span>
<span class="sd">            etalon keys across spectra</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset_etalon_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">dataset_etalon_list</span> <span class="o">+=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">dataset_etalon_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dataset_etalon_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dataset_etalon_list</span></div>

<div class="viewcode-block" id="Dataset.get_molecules"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_molecules">[docs]</a>    <span class="k">def</span> <span class="nf">get_molecules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get list of molecules in spectra.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataset_molecule_list : list</span>
<span class="sd">            list of molecules in spectra</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset_molecule_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">dataset_molecule_list</span> <span class="o">+=</span> <span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">molefraction</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">dataset_molecule_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dataset_molecule_list</span><span class="p">))</span> 
        <span class="k">return</span> <span class="n">dataset_molecule_list</span></div>
       
<div class="viewcode-block" id="Dataset.get_spectra"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_spectra">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span></div>
<div class="viewcode-block" id="Dataset.get_dataset_name"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_dataset_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_dataset_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span></div>
<div class="viewcode-block" id="Dataset.get_baseline_order"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_baseline_order">[docs]</a>    <span class="k">def</span> <span class="nf">get_baseline_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_order</span></div>
<div class="viewcode-block" id="Dataset.set_dataset_name"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.set_dataset_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_dataset_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_dataset_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">new_dataset_name</span></div>
<div class="viewcode-block" id="Dataset.set_baseline_order"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.set_baseline_order">[docs]</a>    <span class="k">def</span> <span class="nf">set_baseline_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_baseline_order</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_order</span> <span class="o">=</span> <span class="n">new_baseline_order</span></div>
<div class="viewcode-block" id="Dataset.set_spectra"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.set_spectra">[docs]</a>    <span class="k">def</span> <span class="nf">set_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_spectra</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span> <span class="o">=</span> <span class="n">new_spectra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renumber_spectra</span><span class="p">()</span></div>
<div class="viewcode-block" id="Dataset.get_number_spectra"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_number_spectra">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.get_spectrum_filename"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_spectrum_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectrum_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrum_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets spectrum filename for spectrum in Dataset.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spectrum_num : int</span>
<span class="sd">            Integer assigned to a given spectrum.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        filename : str</span>
<span class="sd">            if spectrum_num in Dataset then the filename for that the spectrum_number is returned</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span> <span class="o">==</span> <span class="n">spectrum_num</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">get_filename</span><span class="p">())</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dataset.get_spectrum_pressure"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_spectrum_pressure">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectrum_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrum_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets spectrum pressure for spectrum in Dataset.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spectrum_num : int</span>
<span class="sd">            Integer assigned to a given spectrum.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pressure : float</span>
<span class="sd">            if spectrum_num in Dataset then the pressure (torr) for that the spectrum_number is returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span> <span class="o">==</span> <span class="n">spectrum_num</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">get_pressure_torr</span><span class="p">())</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dataset.get_spectrum_temperature"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_spectrum_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectrum_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrum_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets spectrum temperature for spectrum in Dataset.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spectrum_num : int</span>
<span class="sd">            Integer assigned to a given spectrum.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        temperature : float</span>
<span class="sd">            if spectrum_num in Dataset then the temperature (K) for that the spectrum_number is returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span> <span class="o">==</span> <span class="n">spectrum_num</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">())</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dataset.get_spectra_extremes"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_spectra_extremes">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectra_extremes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the minimum and maximum wavenumber for the entire Dataset.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        wave_min : float</span>
<span class="sd">            The minimum wavenumber in all spectra in the Dataset.</span>
<span class="sd">        wave_max : float</span>
<span class="sd">            The maximum wavenumber in all spectra in the Dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get_spectrum_number</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">wave_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span>
                <span class="n">wave_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">wave_min</span><span class="p">:</span>
                    <span class="n">wave_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">wave_max</span><span class="p">:</span>
                    <span class="n">wave_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wave_min</span><span class="p">,</span> <span class="n">wave_max</span></div>

<div class="viewcode-block" id="Dataset.get_spectrum_extremes"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_spectrum_extremes">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectrum_extremes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the minimum and maximum wavenumber for each spectrum in the Dataset.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        extreme_dictionary : dict</span>
<span class="sd">            Dictionary where the key corresponds to the spectrum_num with the value equal to a list where list[0] = minimum wavenumber in spectrum and list[1] = maximum wavenumber in spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extreme_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spectrum</span><span class="o">.</span><span class="n">get_spectrum_number</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">extreme_dictionary</span></div>
            
<div class="viewcode-block" id="Dataset.get_number_nominal_temperatures"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_number_nominal_temperatures">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_nominal_temperatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the number of nominal temperatures in the .</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        num_nominal_temperatures : int</span>
<span class="sd">            number of nominal temperatures in the Dataset</span>
<span class="sd">        nominal_temperatures : list</span>
<span class="sd">            list of all nominal temperatures listed in the input spectra</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nominal_temperatures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">nominal_temperature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nominal_temperatures</span><span class="p">:</span>
                <span class="n">nominal_temperatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">nominal_temperature</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">nominal_temperatures</span><span class="p">),</span> <span class="n">nominal_temperatures</span></div>
         
<div class="viewcode-block" id="Dataset.average_QF"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.average_QF">[docs]</a>    <span class="k">def</span> <span class="nf">average_QF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the Average QF from all spectra.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        average_QF : float</span>
<span class="sd">            average QF of all spectra in dataset</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sum_</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">sum_</span> <span class="o">+=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">calculate_QF</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">sum_</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_spectra</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dataset.get_list_spectrum_numbers"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.get_list_spectrum_numbers">[docs]</a>    <span class="k">def</span> <span class="nf">get_list_spectrum_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates a list of all spectrum_numbers.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        spec_num_list : list</span>
<span class="sd">            list of all spectrum numbers used in the dataset.  </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spec_num_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spec_num_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spec_num_list</span>    </div>
        
<div class="viewcode-block" id="Dataset.generate_baseline_paramlist"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.generate_baseline_paramlist">[docs]</a>    <span class="k">def</span> <span class="nf">generate_baseline_paramlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a csv file called dataset_name + _baseline_paramlist, which will be used to generate another csv file that is used for fitting spectrum dependent parameters with columns for </span>
<span class="sd">        spectrum number, segment number, x_shift, concentration for each molecule in the dataset, baseline terms (a = 0th order term, b = 1st order, etc), and etalon terms (set an amplitude, period, and phase for the number of etalons listed for each spectrum in the Dataset).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        baseline_paramlist : dataframe</span>
<span class="sd">            dataframe containing information describing baseline parameters.  Also saves to .csv.  Either file can be edited before making the baseline parameter list used for fitting.  If editting the .csv file will need to regenerate dataframe from .csv.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">baseline_paramlist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">segments</span><span class="p">)):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span>
                <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span>
                <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Baseline Order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">baseline_order</span>
                <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Pressure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
                <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
                <span class="n">line</span><span class="p">[</span><span class="s1">&#39;x_shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">x_shift</span>
                <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">molefraction</span><span class="p">:</span>
                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;molefraction_&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">ISO</span><span class="p">[(</span><span class="n">molecule</span><span class="p">,</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="p">])]</span> <span class="o">=</span> <span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">molefraction</span><span class="p">[</span><span class="n">molecule</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">97</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                        <span class="n">line</span><span class="p">[</span><span class="s1">&#39;baseline_&#39;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">97</span><span class="p">)]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line</span><span class="p">[</span><span class="s1">&#39;baseline_&#39;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">97</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">etalon_name</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="p">:</span>
                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;etalon_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">etalon_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_amp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="p">[</span><span class="n">etalon_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;etalon_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">etalon_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="p">[</span><span class="n">etalon_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;etalon_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">etalon_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">baseline_paramlist</span>  <span class="o">=</span> <span class="n">baseline_paramlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">baseline_paramlist</span> <span class="o">=</span> <span class="n">baseline_paramlist</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">)</span>
        <span class="n">baseline_paramlist</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">+</span> <span class="s1">&#39;_baseline_paramlist.csv&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">baseline_paramlist</span></div>

<div class="viewcode-block" id="Dataset.generate_summary_file"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.generate_summary_file">[docs]</a>    <span class="k">def</span> <span class="nf">generate_summary_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_file</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates a summary file combining spectral information from all spectra in the Dataset.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_file : bool, optional</span>
<span class="sd">            If True, then a .csv is generated in addition to the dataframe. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        summary_file : dataframe</span>
<span class="sd">            Summary dataframe comprised of spectral information inculding model and residuals for all spectra in Dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">summary_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spectrum_data</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">save_spectrum_info</span><span class="p">(</span><span class="n">save_file</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">summary_file</span> <span class="o">=</span> <span class="n">summary_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrum_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_file</span><span class="p">:</span>
            <span class="n">summary_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">summary_file</span></div>

<div class="viewcode-block" id="Dataset.plot_model_residuals"><a class="viewcode-back" href="../MATS.html#MATS.Dataset.plot_model_residuals">[docs]</a>    <span class="k">def</span> <span class="nf">plot_model_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates a plot showing both the model and experimental data as a function of wavenumber in the main plot with a subplot showing the residuals as function of wavenumber.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">alpha (</span><span class="se">\\</span><span class="s1">frac</span><span class="si">{ppm}{cm}</span><span class="s1">)$&#39;</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavenumbers ($cm^{-1}$)&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals $(</span><span class="se">\\</span><span class="s1">frac</span><span class="si">{ppm}{cm}</span><span class="s1">)$&#39;</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">]</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">plot_color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[((</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span> <span class="o">%</span> <span class="mi">7</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">,</span><span class="n">spectrum</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">plot_color</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">plot_color</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">,</span><span class="n">spectrum</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span> <span class="n">plot_color</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>          </div></div>
           
<div class="viewcode-block" id="max_iter"><a class="viewcode-back" href="../MATS.html#MATS.max_iter">[docs]</a><span class="k">def</span> <span class="nf">max_iter</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used to stop fitting if the number of iterations is greater that 2500</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">iter</span> <span class="o">&gt;</span> <span class="mi">2500</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>
                   
<div class="viewcode-block" id="etalon"><a class="viewcode-back" href="../MATS.html#MATS.etalon">[docs]</a><span class="k">def</span> <span class="nf">etalon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Etalon definition</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">        array of floats used to define the x-axis</span>
<span class="sd">    amp : float</span>
<span class="sd">        amplitude of the etalon.</span>
<span class="sd">    freq : float</span>
<span class="sd">        period of the etalon.</span>
<span class="sd">    phase : float</span>
<span class="sd">        phase of the etalon.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    etalon : array</span>
<span class="sd">        etalon as a function of input x-axis, amplitude, period, and phase.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">amp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">+</span> <span class="n">phase</span><span class="p">)</span>   </div>

    
        
<div class="viewcode-block" id="simulate_spectrum"><a class="viewcode-back" href="../MATS.html#MATS.simulate_spectrum">[docs]</a><span class="k">def</span> <span class="nf">simulate_spectrum</span><span class="p">(</span><span class="n">parameter_linelist</span><span class="p">,</span> <span class="n">wave_min</span><span class="p">,</span> <span class="n">wave_max</span><span class="p">,</span> <span class="n">wave_space</span><span class="p">,</span> <span class="n">wave_error</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                        <span class="n">SNR</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">baseline_terms</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">temperature_err</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{}},</span> <span class="n">pressure</span> <span class="o">=</span> <span class="mi">760</span><span class="p">,</span> 
                        <span class="n">pressure_err</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;per_bias&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{}},</span> 
                        <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">wing_wavenumbers</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">molefraction_err</span> <span class="o">=</span> <span class="p">{},</span>
                        <span class="n">natural_abundance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="p">{},</span><span class="n">diluent</span> <span class="o">=</span> <span class="s1">&#39;air&#39;</span><span class="p">,</span> <span class="n">Diluent</span> <span class="o">=</span> <span class="p">{},</span> 
                        <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="mi">296</span><span class="p">,</span> <span class="n">etalons</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span> <span class="n">num_segments</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generates a synthetic spectrum, where the output is a spectrum object that can be used in MATS classes.</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_linelist : dataframe</span>
<span class="sd">        linelist following the convention of the linelists used for the HTP_from_DF_select.  Note that there will need to be a linemixing column for each nominal temperature, which you will have to do manually (ie y_air_296, y_self_296).</span>
<span class="sd">    wave_min : float</span>
<span class="sd">         minimum wavenumber for the simulation (cm-1)</span>
<span class="sd">    wave_max : float</span>
<span class="sd">        maximum wavenumber for the simulation (cm-1).</span>
<span class="sd">    wave_space : float</span>
<span class="sd">        wavenumber spacing for the simulation (cm-1).</span>
<span class="sd">    wave_error : float, optional</span>
<span class="sd">        absolute error on the wavenumber axis (cm-1) to include in simulations. The default is 0.</span>
<span class="sd">    SNR : float, optional</span>
<span class="sd">        Signal to noise ratio to impose on the simulated spectrum. The default is None.  If SNR is none there is no noise on the simulation.</span>
<span class="sd">    baseline_terms : list, optional</span>
<span class="sd">        polynomial baseline coefficients where the index is equal to the coefficient order, ie. [0, 1, 2] would correspond to baseline = 0 + 1*(wavenumber - minimum wavenumber) + 2*(wavenumber - minimum wavenumber)^2. The default is [0].</span>
<span class="sd">    temperature : float, optional</span>
<span class="sd">         temperature for simulation in celsius. The default is 25.</span>
<span class="sd">    temperature_err : dict, optional</span>
<span class="sd">        possible keys include &#39;bias&#39;, &#39;function&#39;, and &#39;params&#39;. The bias indicates the absolute bias in Celsius of the temperature reading, which will be added to the input temperature. Function can be &#39;linear&#39; with params &#39;m&#39; and &#39;b&#39; or &#39;sine&#39; with parameters &#39;amp&#39;, &#39;freq&#39;, and &#39;phase&#39;. These define a function that is added to both the bias and set temperature as a function of the wavenumber. Note: if &#39;function&#39; key is not equal to None, then there also needs to be a params key to define the function.. The default is {&#39;bias&#39;: 0, &#39;function&#39;: None, &#39;params&#39;: {}}.</span>
<span class="sd">    pressure : float, optional</span>
<span class="sd">        pressure for simulation in torr. The default is 760.</span>
<span class="sd">    pressure_err : dict, optional</span>
<span class="sd">        possible keys include bias, function, and params. The bias indicates the percent bias in of the pressure reading, which will be added to the input pressure. Function can be &#39;linear&#39; with params &#39;m&#39; and &#39;b&#39; or &#39;sine&#39; with parameters &#39;amp&#39;, &#39;freq&#39;, and &#39;phase&#39;. These define a function that is added to both the bias and set pressure as a function of the wavenumber. Note: if &#39;function&#39; key is not equal to None, then there also needs to be a params key to define the function.. The default is {&#39;per_bias&#39;: 0, &#39;function&#39;: None, &#39;params&#39;: {}}.</span>
<span class="sd">    wing_cutoff : float, optional</span>
<span class="sd">        number of voigt half-widths to simulate on either side of each line. The default is 25.</span>
<span class="sd">    wing_wavenumbers : float, optional</span>
<span class="sd">        number of wavenumbers to simulate on either side of each line. The default is 25.</span>
<span class="sd">    wing_method : str, optional</span>
<span class="sd">        Provides choice between the wing_cutoff and wing_wavenumbers line cut-off options. The default is &#39;wing_cutoff&#39;.</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">        allows you to pick the output filename for the simulated spectra. The default is &#39;temp&#39;.</span>
<span class="sd">    molefraction : dict, optional</span>
<span class="sd">        mole fraction of each molecule to be simulated in the spectrum in the format {molec_id: mole fraction (out of 1), molec_id: molefraction, . . . }. The default is {}.</span>
<span class="sd">    molefraction_err : dict, optional</span>
<span class="sd">        percent error in the mole fraction of each molecule to be simulated in the spectrum in the format {molec_id: percent error in mole fraction, molec_id: percent error in mole fraction, . . . }. The default is {}.</span>
<span class="sd">    natural_abundance : bool, optional</span>
<span class="sd">        flag for if the spectrum contains data at natural abundance. The default is True.</span>
<span class="sd">    abundance_ratio_MI : dict, optional</span>
<span class="sd">        if not at natural abundance sets the enhancement factor for each molecule and isotope in the following format {molec_id:{iso_id: enhancement, iso_id: enhancement}, . . . }. The default is {}.</span>
<span class="sd">    diluent : str, optional</span>
<span class="sd">        sets the diluent for the sample if only using one broadener. The default is &#39;air&#39;.</span>
<span class="sd">    Diluent : dict, optional</span>
<span class="sd">        sets the diluent for the sample if there are a combination of several. Format {&#39;he&#39;: 0.5, &#39;air&#39;: 0.5). NOTE: the line parameter file must have parameters that correspond to the diluent (ie gamma0_he, and gamma0_air). Additionally, the contribution from all diluents must sum to 1.. The default is {}.</span>
<span class="sd">    nominal_temperature : int, optional</span>
<span class="sd">        nominal temperature indicates the approximate temperature of the spectrum. When combining spectra into a dataset this acts as a flag to whether temperature dependence terms should be parameters that can be fit or whether they should act as constants.. The default is 296.</span>
<span class="sd">    etalons : dict, optional</span>
<span class="sd">        Allows you to define etalons by an amplitude and period (1/ frequency in cm-1). Default is no etalons. Input is dictionary with keys being a number and the value being an array with the first index being the amplitude and the second being the period.. The default is {}.</span>
<span class="sd">    x_shift : float, optional</span>
<span class="sd">        value in wavenumbers of the x shift for the spectrum axis.. The default is 0.</span>
<span class="sd">    IntensityThreshold : float, optional</span>
<span class="sd">        minimum line intensity to use in the simulation. The default is 1e-30.</span>
<span class="sd">    num_segments : TYPE, optional</span>
<span class="sd">        Number of segments in the file, which is implemented labeling the segment column into equal sequential se . The default is 10.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    spectrum_file : .csv</span>
<span class="sd">        File that contains the simulated wavenumber axis, noisy wavenumber axis, absorbance data, noisy absorbance data, pressure (torr), and temperature (C). The filename will correspond to the filename parameter, which has a default value of temp. The pressure and temperature columns will include whatever functional change there is to the pressure or temperature, but not the bias offset. This is coded to match how this error would manifest in experiments.</span>
<span class="sd">    spectrum_object : object</span>
<span class="sd">        Outputs a Spectrum class object. This makes it so the you can easily switch between reading in an experimental spectrum and simulated a synthetic spectrum by simply switching out whether the spectrum object is defined through the class definition or through the simulate_spectrum function.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Checks to make a Diluent dictionary has been assigned    </span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Diluent</span><span class="p">:</span>
        <span class="n">Diluent</span> <span class="o">=</span> <span class="p">{</span><span class="n">diluent</span><span class="p">:</span><span class="mf">1.</span><span class="p">}</span>
    <span class="c1">#Generates a linemixing column for each Diluent</span>
    <span class="k">for</span> <span class="n">dil</span> <span class="ow">in</span> <span class="n">Diluent</span><span class="p">:</span>
        <span class="n">parameter_linelist</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">dil</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter_linelist</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">dil</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temperature</span><span class="p">)]</span>
    <span class="c1">#Set-Up Parameters</span>
    <span class="n">baseline_terms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">baseline_terms</span><span class="p">)</span>
    <span class="n">temperature_K</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">+</span> <span class="mf">273.15</span>
    <span class="n">pressure_atm</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">/</span> <span class="mi">760</span>
    <span class="n">wavenumbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">wave_min</span><span class="p">,</span> <span class="n">wave_max</span> <span class="o">+</span> <span class="n">wave_space</span><span class="p">,</span> <span class="n">wave_space</span><span class="p">)</span>

    <span class="n">wavenumbers_err</span> <span class="o">=</span> <span class="n">wavenumbers</span> <span class="o">+</span> <span class="n">wave_error</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">))</span>
    <span class="c1">#molefraction error</span>
    <span class="n">molefraction_w_error</span> <span class="o">=</span> <span class="p">{}</span>        
    <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">molefraction</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">molefraction_err</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="n">molefraction_err</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">molefraction_w_error</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">molefraction</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">+</span> <span class="n">molefraction</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">molefraction_err</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1">#pressure error</span>
    <span class="n">pressure_w_error</span> <span class="o">=</span> <span class="n">pressure_atm</span> <span class="o">+</span> <span class="n">pressure_atm</span><span class="o">*</span><span class="p">(</span><span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;per_bias&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="c1">#adds the pressure bias based on the percent bias of the pressure measaurement.  Can loop this or set this to be constant for all spectra</span>
    <span class="n">pressure_w_error</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">pressure_w_error</span><span class="p">]</span>   
    <span class="k">if</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;params&#39;</span> <span class="ow">in</span> <span class="n">pressure_err</span><span class="p">:</span>
            <span class="n">pressure_w_error</span> <span class="o">+=</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;m&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">wavenumbers</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">))</span> <span class="o">+</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sine&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;params&#39;</span> <span class="ow">in</span> <span class="n">pressure_err</span><span class="p">:</span>
            <span class="n">pressure_w_error</span> <span class="o">+=</span> <span class="n">etalon</span><span class="p">((</span><span class="n">wavenumbers</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)),</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">],</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">])</span>
    <span class="c1">#temperature error  </span>
    <span class="n">temperature_w_error</span> <span class="o">=</span> <span class="n">temperature_K</span> <span class="o">+</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
    <span class="n">temperature_w_error</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">temperature_w_error</span><span class="p">]</span> 
    <span class="k">if</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;params&#39;</span> <span class="ow">in</span> <span class="n">pressure_err</span><span class="p">:</span>
            <span class="n">temperature_w_error</span> <span class="o">+=</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;m&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">wavenumbers</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">))</span> <span class="o">+</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sine&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;params&#39;</span> <span class="ow">in</span> <span class="n">pressure_err</span><span class="p">:</span>
            <span class="n">temperature_w_error</span> <span class="o">+=</span> <span class="n">etalon</span><span class="p">((</span><span class="n">wavenumbers</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)),</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">],</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">])</span>

    <span class="c1">#Define Segments</span>
    <span class="n">seg_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">))</span>
    <span class="n">seg_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">seg_number</span><span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">/</span><span class="n">num_segments</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">alpha_array</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pressure_array</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">temperature_array</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_segments</span><span class="p">):</span>

        <span class="n">segment_array</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">seg_number</span> <span class="o">==</span> <span class="n">seg</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">waves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">,</span> <span class="n">segment_array</span><span class="p">)</span>
        <span class="n">segment_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pressure_w_error</span><span class="p">,</span> <span class="n">segment_array</span><span class="p">))</span>
        <span class="n">segment_temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">temperature_w_error</span><span class="p">,</span> <span class="n">segment_array</span><span class="p">))</span>

  
        <span class="n">waves</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">HTP_from_DF_select</span><span class="p">(</span><span class="n">parameter_linelist</span><span class="p">,</span><span class="n">waves</span> <span class="p">,</span> <span class="n">wing_cutoff</span><span class="p">,</span> <span class="n">wing_wavenumbers</span><span class="p">,</span> <span class="n">wing_method</span><span class="p">,</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="n">segment_pressure</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">segment_temperature</span><span class="p">,</span>  <span class="n">molefraction</span> <span class="o">=</span> <span class="n">molefraction_w_error</span><span class="p">,</span> 
                            <span class="n">natural_abundance</span> <span class="o">=</span> <span class="n">natural_abundance</span><span class="p">,</span> <span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="n">abundance_ratio_MI</span><span class="p">,</span>  
                            <span class="n">Diluent</span> <span class="o">=</span> <span class="n">Diluent</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="n">diluent</span><span class="p">,</span> <span class="n">IntensityThreshold</span> <span class="o">=</span> <span class="n">IntensityThreshold</span><span class="p">)</span>
        <span class="n">alpha_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">segment_array</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">segment_array</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">1e6</span>

        <span class="n">pressure_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">segment_array</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">segment_array</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">segment_pressure</span><span class="p">]</span>
        <span class="n">temperature_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">segment_array</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">segment_array</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">segment_temperature</span><span class="p">]</span>
    <span class="n">pressure_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pressure_array</span><span class="p">)</span> <span class="o">-</span> <span class="n">pressure_atm</span><span class="o">*</span><span class="p">(</span><span class="n">pressure_err</span><span class="p">[</span><span class="s1">&#39;per_bias&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">temperature_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">temperature_array</span><span class="p">)</span> <span class="o">-</span> <span class="n">temperature_err</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
    
    <span class="c1">#Calculate Baseline</span>
    <span class="n">baseline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">baseline_terms</span><span class="p">,</span> <span class="n">wavenumbers</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span> <span class="p">)</span>
    <span class="c1"># Calculate Etalons</span>
    <span class="n">etalon_model</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">etalons</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">wavenumbers</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span>
        <span class="n">etalon_model</span> <span class="o">+=</span> <span class="n">amp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">+</span> <span class="n">phase</span><span class="p">)</span> 
    <span class="c1">#Calculate Noisy Spectrum</span>
    <span class="k">if</span> <span class="n">SNR</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alpha_noise</span> <span class="o">=</span> <span class="n">alpha_array</span>
    <span class="k">else</span><span class="p">:</span>   
        <span class="n">alpha_noise</span> <span class="o">=</span> <span class="n">alpha_array</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">alpha_array</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_array</span><span class="p">))</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">SNR</span>
    <span class="n">alpha_noise</span> <span class="o">+=</span> <span class="p">(</span><span class="n">baseline</span> <span class="o">+</span> <span class="n">etalon_model</span><span class="p">)</span> 
    <span class="c1">#Generate and save Simulated Spectrum File</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg_number</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;Wavenumber (cm-1)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wavenumbers</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;Wavenumber + Noise (cm-1)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wavenumbers_err</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;Alpha (ppm/cm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_array</span> <span class="o">+</span> <span class="n">baseline</span> <span class="o">+</span> <span class="n">etalon_model</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;Alpha + Noise (ppm/cm)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_noise</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;Pressure (Torr)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pressure_array</span><span class="o">*</span><span class="mi">760</span>
    <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature_array</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Returns a spectrum class object for facile integration into the fitting workflow</span>
    <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="n">molefraction</span><span class="p">,</span> <span class="n">natural_abundance</span> <span class="o">=</span> <span class="n">natural_abundance</span><span class="p">,</span> <span class="n">diluent</span> <span class="o">=</span> <span class="n">diluent</span><span class="p">,</span> <span class="n">Diluent</span> <span class="o">=</span> <span class="n">Diluent</span><span class="p">,</span> <span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="n">abundance_ratio_MI</span><span class="p">,</span> <span class="n">spectrum_number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                <span class="n">input_freq</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">input_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                <span class="n">pressure_column</span> <span class="o">=</span> <span class="s1">&#39;Pressure (Torr)&#39;</span><span class="p">,</span> <span class="n">temperature_column</span> <span class="o">=</span> <span class="s1">&#39;Temperature (C)&#39;</span><span class="p">,</span> <span class="n">frequency_column</span> <span class="o">=</span> <span class="s1">&#39;Wavenumber + Noise (cm-1)&#39;</span><span class="p">,</span> 
                <span class="n">tau_column</span> <span class="o">=</span> <span class="s1">&#39;Alpha + Noise (ppm/cm)&#39;</span><span class="p">,</span> <span class="n">tau_stats_column</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">segment_column</span> <span class="o">=</span> <span class="s1">&#39;Segment Number&#39;</span><span class="p">,</span>
                <span class="n">etalons</span> <span class="o">=</span> <span class="n">etalons</span><span class="p">,</span> <span class="n">nominal_temperature</span> <span class="o">=</span> <span class="n">nominal_temperature</span><span class="p">,</span> <span class="n">x_shift</span> <span class="o">=</span> <span class="n">x_shift</span><span class="p">,</span> <span class="n">baseline_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline_terms</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Generate_FitParam_File"><a class="viewcode-back" href="../MATS.html#MATS.Generate_FitParam_File">[docs]</a><span class="k">class</span> <span class="nc">Generate_FitParam_File</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class generates the parameter files used in fitting and sets up fit settings.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset : object</span>
<span class="sd">        Dataset object to be used in the fits</span>
<span class="sd">    param_linelist : dataframe</span>
<span class="sd">        parameter linelist dataframe name, where the dataframe has the appropriate column headers</span>
<span class="sd">    base_linelist : dataframe</span>
<span class="sd">        baseline parameter dataframe name generated from the dataset.generate_baseline_paramlist() function.</span>
<span class="sd">    lineprofile : str</span>
<span class="sd">        lineprofile to use for the simulation. This sets values in the parameter linelist to 0 and forces them to not vary unless manually changed. Default values is VP, voigt profile. Options are VP, SDVP, NGP, SDNGP, HTP.</span>
<span class="sd">    linemixing : bool</span>
<span class="sd">        If False, then all linemixing parameters are set to 0 and not able to float.  Default is False.</span>
<span class="sd">    threshold_intensity : float</span>
<span class="sd">        This is the minimum line intensity that will be simulated. Default value is 1e-30.</span>
<span class="sd">    fit_intensity  : float</span>
<span class="sd">        This is the minimum line intensity for which parameters will be set to float. This can be overwritten manually. Default value is 1e-26.</span>
<span class="sd">    fit_window : float</span>
<span class="sd">        currently not used</span>
<span class="sd">    sim_window : float</span>
<span class="sd">        This is the region outside of the wavelength region of the dataset that will be simulated for analysis. Default value is 5 cm-1.</span>
<span class="sd">    base_linelist_savename : str</span>
<span class="sd">        filename that the baseline linelist will be saved as. Default is Baseline_LineList</span>
<span class="sd">    param_linelist_savename : str</span>
<span class="sd">        filename that the parameter linelist will be saved as. Default is Parameter_LineList.</span>
<span class="sd">    nu_constrain : bool</span>
<span class="sd">        True indicates that the line centers will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    sw_constrain : bool</span>
<span class="sd">        True indicates that the line intensities will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    gamma0_constrain : bool</span>
<span class="sd">        True indicates that the collisional width will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    delta0_constrain : bool</span>
<span class="sd">        True indicates that the shift will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    aw_constrain : bool</span>
<span class="sd">        True indicates that the speed dependent width will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    as_constrain : bool</span>
<span class="sd">        True indicates that the speed dependent shift will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    nuVC_constrain : bool</span>
<span class="sd">        True indicates that the dicke narrowing term will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    eta_constrain : bool</span>
<span class="sd">        True indicates that the correlation parameter will be a global variable across all spectra. False generates a new value for each spectrum in the dataset.</span>
<span class="sd">    linemixing_constrain : bool</span>
<span class="sd">        True indicates that the first-order linemixing term will be a global variable across all spectra. False generates a new value for each spectrum in the datas</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">param_linelist</span><span class="p">,</span> <span class="n">base_linelist</span><span class="p">,</span> 
                  <span class="n">lineprofile</span> <span class="o">=</span> <span class="s1">&#39;VP&#39;</span><span class="p">,</span> <span class="n">linemixing</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">threshold_intensity</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span> <span class="n">fit_intensity</span> <span class="o">=</span> <span class="mf">1e-26</span><span class="p">,</span> <span class="n">fit_window</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">sim_window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                  <span class="n">param_linelist_savename</span> <span class="o">=</span> <span class="s1">&#39;Parameter_LineList&#39;</span><span class="p">,</span> <span class="n">base_linelist_savename</span> <span class="o">=</span> <span class="s1">&#39;Baseline_LineList&#39;</span><span class="p">,</span> 
                 <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">aw_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                 <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eta_constrain</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linemixing_constrain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_linelist</span> <span class="o">=</span> <span class="n">param_linelist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_linelist</span> <span class="o">=</span> <span class="n">base_linelist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">=</span> <span class="n">lineprofile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linemixing</span> <span class="o">=</span> <span class="n">linemixing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold_intensity</span> <span class="o">=</span> <span class="n">threshold_intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_intensity</span> <span class="o">=</span> <span class="n">fit_intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_window</span> <span class="o">=</span> <span class="n">fit_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_window</span> <span class="o">=</span> <span class="n">sim_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_linelist_savename</span> <span class="o">=</span> <span class="n">base_linelist_savename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_linelist_savename</span> <span class="o">=</span> <span class="n">param_linelist_savename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu_constrain</span> <span class="o">=</span> <span class="n">nu_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw_constrain</span> <span class="o">=</span> <span class="n">sw_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="n">gamma0_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta0_constrain</span> <span class="o">=</span> <span class="n">delta0_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aw_constrain</span> <span class="o">=</span> <span class="n">aw_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_constrain</span> <span class="o">=</span> <span class="n">as_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="n">nuVC_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_constrain</span> <span class="o">=</span> <span class="n">eta_constrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_constrain</span> <span class="o">=</span> <span class="n">linemixing_constrain</span>
<div class="viewcode-block" id="Generate_FitParam_File.get_dataset"><a class="viewcode-back" href="../MATS.html#MATS.Generate_FitParam_File.get_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span></div>
<div class="viewcode-block" id="Generate_FitParam_File.get_param_linelist"><a class="viewcode-back" href="../MATS.html#MATS.Generate_FitParam_File.get_param_linelist">[docs]</a>    <span class="k">def</span> <span class="nf">get_param_linelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_linelist</span></div>
<div class="viewcode-block" id="Generate_FitParam_File.get_base_linelist"><a class="viewcode-back" href="../MATS.html#MATS.Generate_FitParam_File.get_base_linelist">[docs]</a>    <span class="k">def</span> <span class="nf">get_base_linelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_linelist</span></div>
<div class="viewcode-block" id="Generate_FitParam_File.generate_fit_param_linelist_from_linelist"><a class="viewcode-back" href="../MATS.html#MATS.Generate_FitParam_File.generate_fit_param_linelist_from_linelist">[docs]</a>    <span class="k">def</span> <span class="nf">generate_fit_param_linelist_from_linelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vary_nu</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_sw</span> <span class="o">=</span> <span class="p">{},</span>
                                   <span class="n">vary_gamma0</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_gamma0</span> <span class="o">=</span> <span class="p">{},</span> 
                                   <span class="n">vary_delta0</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_delta0</span> <span class="o">=</span> <span class="p">{},</span> 
                                   <span class="n">vary_aw</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_gamma2</span> <span class="o">=</span> <span class="p">{},</span> 
                                   <span class="n">vary_as</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_delta2</span> <span class="o">=</span> <span class="p">{},</span> 
                                   <span class="n">vary_nuVC</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_n_nuVC</span> <span class="o">=</span> <span class="p">{},</span>
                                   <span class="n">vary_eta</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_linemixing</span> <span class="o">=</span> <span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;Generates the parameter line list used in fitting and updates the fitting booleans to desired settings.</span>
<span class="sd">               </span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vary_nu : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope line centers should be floated.  Each key in the dictionary corresponds to a molecule, where the values are a dictionary corresponding to local_iso_ids as keys and boolean values acting as boolean flags. True means float the nu for that molecule and isotope. Example vary_nu = {7:{1:True, 2: False, 3: False}, 1:{1:False, 2: False, 3: False}}, would indicate that line centers of all main oxygen isotopes would be floated (if the line intensity is greater than the fit intensity), where the line centers for all other O2 isotopes and all water isotopes would not be varied. If these value are left blank, then all variable would have to be manually switched to float. The default is {}.</span>
<span class="sd">        vary_sw : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope line intensities should be floated.  Follows nu_vary example.  The default is {}.</span>
<span class="sd">        vary_gamma0 : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope collisional half-width should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_n_gamma0 : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope coefficient of the temperature dependence of the half width  should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_delta0 : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope pressure shift should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_n_delta0 : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope coefficient of the temperature dependence of the pressure shift should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_aw : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope ratio of the speed dependent width to the half-width should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_n_gamma2 : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope coefficient of the temperature dependence of the speed dependent width should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_as : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope the ratio of the speed dependent shift to the shift should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_n_delta2 : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope coefficient of the temperature dependence of the speed dependent shift should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_nuVC : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope dicke narrowing should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_n_nuVC : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope  coefficient of the temperature dependence of the dicke narrowing should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_eta : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope correlation parameter for the VC and SD effects should be floated.  Follows nu_vary example.  . The default is {}.</span>
<span class="sd">        vary_linemixing : bool, optional</span>
<span class="sd">            Dictionary of dictionaries setting whether the molecule and isotope first-order line-mixing should be floated.  Follows nu_vary example.  . The default is {}.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        param_linelist_df : dataframe</span>
<span class="sd">            returns dataframe based on parameter line list with addition of a vary and err column for every floatable parameter.  The vary columns are defined by the inputs and the fit_intensity value.  The err columns will be populated from fit results.  The dataframe is also saved as a .csv file.  line intensity will be normalized by the fit_intensity (set to the sw_scale_factor). The term &#39;sw&#39; is now equal to the normalized value, such that in the simulation &#39;sw&#39;*sw_scale_factor is used for the line intensity. Because line intensities are so small it is difficult to fit the value without normalization. </span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_param_linelist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#Intensity Thresholding</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_intensity</span><span class="p">]</span> <span class="c1">#intensity thresholding</span>
        <span class="c1">#Cutdown linelist to parameters within specified simulation window of minimum and maximum of dataset</span>
        <span class="n">dataset_min</span><span class="p">,</span> <span class="n">dataset_max</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_spectra_extremes</span><span class="p">())</span>
        <span class="n">extreme_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_spectrum_extremes</span><span class="p">()</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">dataset_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_window</span><span class="p">)]</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">dataset_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_window</span><span class="p">)]</span>
        <span class="c1">#delete parameters not partaining to species (where relevant)</span>
        <span class="n">diluent_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">diluent</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">Diluent</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">diluent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">diluent_list</span><span class="p">:</span>
                    <span class="n">diluent_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diluent</span><span class="p">)</span>
        <span class="n">num_nominal_temps</span><span class="p">,</span> <span class="n">list_nominal_temps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_number_nominal_temperatures</span><span class="p">()</span>
        <span class="n">column_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">,</span> <span class="s1">&#39;local_iso_id&#39;</span><span class="p">,</span><span class="s1">&#39;elower&#39;</span><span class="p">,</span> <span class="s1">&#39;nu&#39;</span><span class="p">,</span> <span class="s1">&#39;sw&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">diluent</span> <span class="ow">in</span> <span class="n">diluent_list</span><span class="p">:</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_gamma0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_delta0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_gamma2_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_delta2_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">nominal_temperature</span> <span class="ow">in</span> <span class="n">list_nominal_temps</span><span class="p">:</span>
                <span class="n">column_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temperature</span><span class="p">))</span> <span class="c1">## Fix this so it has the nominal temperatures</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="n">column_list</span><span class="p">]</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1">#Re-defines the Line intensity as sw*sw_scale_factor</span>
        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_intensity</span>
        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw_scale_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_intensity</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span>
        
        <span class="c1"># Defines the Linecenter parameters in the event that the line center is held constant across all samples and is not</span>
        <span class="c1">## Starting point is equal to the inital value</span>
        <span class="n">order_nu</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span>
        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_constrain</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vary_nu</span> <span class="o">!=</span> <span class="p">{}:</span>
                <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_nu</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_nu</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;nu_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_nu</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">order_nu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nu_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vary_nu</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_nu</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_nu</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                            <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;nu_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_nu</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>             
        
        <span class="c1"># Defines the linestrength in the event that the sw is held constant across all samples and not</span>
        <span class="c1">## Starting point is equal to the initial value</span>
        <span class="n">order_sw</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">,</span> <span class="s1">&#39;sw_scale_factor&#39;</span><span class="p">]</span>
        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_constrain</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vary_sw</span> <span class="o">!=</span> <span class="p">{}:</span>
                 <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_sw</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_sw</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;sw_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_sw</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">order_sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sw_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vary_sw</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_sw</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_sw</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                            <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;sw_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_sw</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
        
        <span class="c1">#Loop through other parameters and then set things to 0 based on lineshape </span>
        <span class="n">order_gamma0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">order_delta0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">order_SD_gamma</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">order_SD_delta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">order_nuVC</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">order_eta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">order_linemixing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">diluent</span> <span class="ow">in</span> <span class="n">diluent_list</span><span class="p">:</span>
            <span class="c1">#Gamma0 option for constrain and not constrained</span>
            <span class="n">order_gamma0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_constrain</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vary_gamma0</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_gamma0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_gamma0</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                            <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_gamma0</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                    <span class="n">order_gamma0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;gamma0_&#39;</span><span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">vary_gamma0</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_gamma0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_gamma0</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_gamma0</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="n">order_gamma0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_gamma0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="p">)</span>

            <span class="c1">#Delta0 option for constrain and not constrained</span>
            <span class="n">order_delta0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta0_constrain</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vary_delta0</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_delta0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_delta0</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                            <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_delta0</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                    <span class="n">order_delta0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span>  <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">vary_delta0</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_delta0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_delta0</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_delta0</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="n">order_delta0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_delta0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="p">)</span>
 
            <span class="c1">#SD Gamma option for constrain and not constrained</span>
            <span class="n">order_SD_gamma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="p">)</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aw_constrain</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">):</span>
                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">vary_aw</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_aw</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_aw</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_aw</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                    <span class="n">order_SD_gamma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">):</span>
                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">vary_aw</span> <span class="o">!=</span> <span class="p">{}:</span>
                            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_aw</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_aw</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_aw</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="n">order_SD_gamma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_gamma2_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="p">)</span>

            <span class="c1">#SD Delta option for constrain and not constrained</span>
            <span class="n">order_SD_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_constrain</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">):</span>
                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">vary_as</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_as</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_as</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_as</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                    <span class="n">order_SD_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">):</span>
                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;SD_deltaamma_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">vary_as</span> <span class="o">!=</span> <span class="p">{}:</span>
                            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_as</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_as</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_as</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>           
            <span class="n">order_SD_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_delta2_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="p">)</span>

            <span class="c1">#nuVC option for constrain and not constrained</span>
            <span class="n">order_nuVC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_constrain</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">):</span>
                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">vary_nuVC</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_nuVC</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_nuVC</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_nuVC</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                    <span class="n">order_nuVC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">):</span>
                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>                       
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">vary_nuVC</span> <span class="o">!=</span> <span class="p">{}:</span>
                            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_nuVC</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_nuVC</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_nuVC</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="n">order_nuVC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_nuVC_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="p">)</span>

            <span class="c1">#eta option for constrain and not constrained</span>
            <span class="n">order_eta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">)</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_constrain</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;SDNGP&#39;</span><span class="p">):</span>
                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">vary_eta</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_eta</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_eta</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;eta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_eta</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                    <span class="n">order_eta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                    <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;SDNGP&#39;</span><span class="p">):</span>
                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;eta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>                       
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">vary_eta</span> <span class="o">!=</span> <span class="p">{}:</span>
                            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_eta</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_eta</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;eta_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_eta</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
            
            <span class="c1"># Linemixing</span>
            <span class="k">for</span> <span class="n">nominal_temp</span> <span class="ow">in</span> <span class="n">list_nominal_temps</span><span class="p">:</span>
                <span class="n">order_linemixing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">))</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_constrain</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing</span><span class="p">:</span>
                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">vary_linemixing</span> <span class="o">!=</span> <span class="p">{}:</span>
                            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_linemixing</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_linemixing</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                    <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;y_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_linemixing</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_list_spectrum_numbers</span><span class="p">():</span>
                        <span class="n">order_linemixing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                        <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing</span><span class="p">:</span>
                            <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">diluent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">vary_linemixing</span> <span class="o">!=</span> <span class="p">{}:</span>
                                <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_linemixing</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_linemixing</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">extreme_dictionary</span><span class="p">[</span><span class="n">spec</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;y_&#39;</span> <span class="o">+</span><span class="n">diluent</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_linemixing</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>

            <span class="c1">#Temperature Dependence</span>
            <span class="k">if</span> <span class="n">num_nominal_temps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_gamma0_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_gamma0_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_delta0_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_delta0_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_gamma2_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_gamma2_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_delta2_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_delta2_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_nuVC_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                <span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;n_nuVC_&#39;</span><span class="o">+</span><span class="n">diluent</span><span class="o">+</span><span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1">#n_Gamma0</span>
                <span class="k">if</span> <span class="n">vary_n_gamma0</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_n_gamma0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_n_gamma0</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                            <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;n_gamma0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_n_gamma0</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
                <span class="c1">#n_Delta0</span>
                <span class="k">if</span> <span class="n">vary_n_delta0</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_n_delta0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_n_delta0</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                            <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;n_delta0_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_n_delta0</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
                <span class="c1">#n_Gamma2</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">vary_n_gamma2</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_n_gamma2</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_n_gamma2</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;n_gamma2_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_n_gamma2</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
                <span class="c1">#n_Delta2</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;NGP&#39;</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">vary_n_delta2</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_n_delta2</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_n_delta2</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;n_delta2_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_n_delta2</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
                <span class="c1">#n_nuVC</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineprofile</span> <span class="o">==</span> <span class="s1">&#39;SDVP&#39;</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">vary_n_nuVC</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_n_nuVC</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">vary_n_nuVC</span><span class="p">[</span><span class="n">molecule</span><span class="p">]:</span>
                                <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dataset_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dataset_max</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">molecule</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">param_linelist_df</span><span class="p">[</span><span class="s1">&#39;local_iso_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">),</span> <span class="s1">&#39;n_nuVC_&#39;</span> <span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_n_nuVC</span><span class="p">[</span><span class="n">molecule</span><span class="p">][</span><span class="n">isotope</span><span class="p">])</span>
        <span class="n">ordered_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">,</span> <span class="s1">&#39;local_iso_id&#39;</span><span class="p">,</span><span class="s1">&#39;elower&#39;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_nu</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_sw</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="s1">&#39;sw_scale_factor&#39;</span><span class="p">:</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_gamma0</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_nominal_temps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;n_&#39;</span> <span class="o">!=</span> <span class="n">item</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_delta0</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_nominal_temps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;n_&#39;</span> <span class="o">!=</span> <span class="n">item</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_nuVC</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_nominal_temps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;n_&#39;</span> <span class="o">!=</span> <span class="n">item</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_SD_gamma</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_nominal_temps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;n_&#39;</span> <span class="o">!=</span> <span class="n">item</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_SD_delta</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_nominal_temps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;n_&#39;</span> <span class="o">!=</span> <span class="n">item</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
                    <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_eta</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_linemixing</span><span class="p">:</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">)</span>
            <span class="n">ordered_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">)</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">param_linelist_df</span><span class="p">[</span><span class="n">ordered_list</span><span class="p">]</span>
        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_linelist_savename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">param_linelist_df</span> </div>

<div class="viewcode-block" id="Generate_FitParam_File.generate_fit_baseline_linelist"><a class="viewcode-back" href="../MATS.html#MATS.Generate_FitParam_File.generate_fit_baseline_linelist">[docs]</a>    <span class="k">def</span> <span class="nf">generate_fit_baseline_linelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vary_baseline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">vary_pressure</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_temperature</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">vary_molefraction</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vary_xshift</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                                      <span class="n">vary_etalon_amp</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_etalon_freq</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vary_etalon_phase</span><span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the baseline line list used in fitting and updates the fitting booleans to desired settings.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vary_baseline : bool, optional</span>
<span class="sd">            If True, then sets all baseline parameters for all spectra to float. The default is True.</span>
<span class="sd">        vary_pressure : bool, optional</span>
<span class="sd">            If True, then the pressures for all spectra are floated.  This should be used with caution as the impact these parameters have on other floated parameters might lead to an unstable solution. The default is False.</span>
<span class="sd">        vary_temperature : bool, optional</span>
<span class="sd">            If True, then the temperatures for all spectra are floated. This should be used with caution as the impact these parameters have on other floated parameters might lead to an unstable solution.The default is False.</span>
<span class="sd">        vary_molefraction : dict, optional</span>
<span class="sd">            keys to dictionary correspond to molecule id where the value is boolean flag, which dictates whether to float the mole fraction. The default is {}. Example: {7: True, 1: False}</span>
<span class="sd">        vary_xshift : bool, optional</span>
<span class="sd">            If True, then sets x-shift parameters for all spectra to float. The default is False.</span>
<span class="sd">        vary_etalon_amp : bool, optional</span>
<span class="sd">            If True, then sets etalon amplitude parameters for all spectra to float. The default is False.</span>
<span class="sd">        vary_etalon_freq : bool, optional</span>
<span class="sd">            If True, then sets etalon period parameters for all spectra to float. . The default is False.</span>
<span class="sd">        vary_etalon_phase : bool, optional</span>
<span class="sd">            If True, then sets etalon phase parameters for all spectra to float.. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        base_linelist_df : dataframe</span>
<span class="sd">            returns dataframe based on baseline line list with addition of a vary and err column for every floatable parameter.  The vary columns are defined by the inputs.  The err columns will be populated from fit results.  The dataframe is also saved as a .csv file..</span>



<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_linelist_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_base_linelist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">parameters</span> <span class="o">=</span>  <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">base_linelist_df</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Baseline Order&#39;</span> <span class="o">!=</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Segment Number&#39;</span> <span class="o">!=</span> <span class="n">param</span><span class="p">):</span>
                <span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span><span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s1">&#39;Pressure&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[(</span><span class="n">vary_pressure</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vary_pressure</span><span class="p">):</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;USE CAUTION WHEN FLOATING PRESSURES&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Temperature&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[(</span><span class="n">vary_temperature</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vary_temperature</span><span class="p">):</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;USE CAUTION WHEN FLOATING TEMPERATURES&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;x_shift&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_linelist_df</span><span class="p">)</span><span class="o">*</span><span class="p">[(</span><span class="n">vary_xshift</span><span class="p">)]</span>
            <span class="k">if</span> <span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;baseline_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">97</span>
                <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_linelist_df</span><span class="p">[</span><span class="s1">&#39;Baseline Order&#39;</span><span class="p">]</span><span class="o">&gt;=</span> <span class="n">order</span><span class="p">,</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vary_baseline</span>         
            <span class="k">if</span> <span class="s1">&#39;molefraction&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">vary_molefraction</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ISO</span><span class="p">[(</span><span class="n">molecule</span><span class="p">,</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="p">])</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>  
                        <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_molefraction</span><span class="p">[</span><span class="n">molecule</span><span class="p">])</span>                                
            <span class="k">if</span> <span class="s1">&#39;amp&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_etalon_amp</span><span class="p">)</span> 
            <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_etalon_freq</span><span class="p">)</span> 
            <span class="k">if</span> <span class="s1">&#39;phase&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_linelist_df</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;phase&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">)]</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vary_etalon_phase</span><span class="p">)</span>
        <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Baseline Order&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">base_linelist_df</span> <span class="o">=</span> <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">base_linelist_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_linelist_savename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">base_linelist_df</span></div></div>
    
<div class="viewcode-block" id="Edit_Fit_Param_Files"><a class="viewcode-back" href="../MATS.html#MATS.Edit_Fit_Param_Files">[docs]</a><span class="k">class</span> <span class="nc">Edit_Fit_Param_Files</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Allows for the baseline and parameter files to be editted in jupyter notebook.  Can also edit everything in .csv</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    base_linelist_file : str</span>
<span class="sd">        name of the .csv file containing the baseline parameters generated in format specified in the generate fit parameters class.</span>
<span class="sd">    param_linelist_file : str</span>
<span class="sd">        name of the .csv file containing the linelist parameters generated in format specified in the generate fit parameters class.</span>
<span class="sd">    new_base_linelist_file : str</span>
<span class="sd">        name of the to save the baseline param list as after editing. IF the value is None (default) then it will edit the input.</span>
<span class="sd">    new_param_linelist_file  : str</span>
<span class="sd">        name of the to save the linelist param list as after editing. IF the value is None (default) then it will edit the input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_linelist_file</span><span class="p">,</span> <span class="n">param_linelist_file</span><span class="p">,</span> <span class="n">new_base_linelist_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">new_param_linelist_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_linelist_file</span> <span class="o">=</span> <span class="n">base_linelist_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_linelist_file</span> <span class="o">=</span> <span class="n">param_linelist_file</span>
        <span class="k">if</span> <span class="n">new_base_linelist_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_base_linelist_file</span> <span class="o">=</span> <span class="n">base_linelist_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_base_linelist_file</span> <span class="o">=</span> <span class="n">new_base_linelist_file</span>
        <span class="k">if</span> <span class="n">new_param_linelist_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_param_linelist_file</span> <span class="o">=</span> <span class="n">param_linelist_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_param_linelist_file</span> <span class="o">=</span> <span class="n">new_param_linelist_file</span>
<div class="viewcode-block" id="Edit_Fit_Param_Files.edit_generated_baselist"><a class="viewcode-back" href="../MATS.html#MATS.Edit_Fit_Param_Files.edit_generated_baselist">[docs]</a>    <span class="k">def</span> <span class="nf">edit_generated_baselist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allows editting of baseline linelist in notebook        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_linelist_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_linelist_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">baseline_widget</span> <span class="o">=</span> <span class="n">qgrid</span><span class="o">.</span><span class="n">show_grid</span><span class="p">(</span><span class="n">base_linelist_df</span><span class="p">,</span> <span class="n">grid_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;forceFitColumns&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;defaultColumnWidth&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">baseline_widget</span></div>
<div class="viewcode-block" id="Edit_Fit_Param_Files.save_editted_baselist"><a class="viewcode-back" href="../MATS.html#MATS.Edit_Fit_Param_Files.save_editted_baselist">[docs]</a>    <span class="k">def</span> <span class="nf">save_editted_baselist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_widget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves edits of baseline linelist in notebook        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_linelist_df</span> <span class="o">=</span> <span class="n">baseline_widget</span><span class="o">.</span><span class="n">get_changed_df</span><span class="p">()</span>
        <span class="n">base_linelist_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_base_linelist_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">base_linelist_df</span></div>
<div class="viewcode-block" id="Edit_Fit_Param_Files.edit_generated_paramlist"><a class="viewcode-back" href="../MATS.html#MATS.Edit_Fit_Param_Files.edit_generated_paramlist">[docs]</a>    <span class="k">def</span> <span class="nf">edit_generated_paramlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allows editting of parameter linelist in notebook        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_linelist_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">param_widget</span> <span class="o">=</span> <span class="n">qgrid</span><span class="o">.</span><span class="n">show_grid</span><span class="p">(</span><span class="n">param_linelist_df</span><span class="p">,</span> <span class="n">grid_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;forceFitColumns&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;defaultColumnWidth&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">param_widget</span></div>
<div class="viewcode-block" id="Edit_Fit_Param_Files.save_editted_paramlist"><a class="viewcode-back" href="../MATS.html#MATS.Edit_Fit_Param_Files.save_editted_paramlist">[docs]</a>    <span class="k">def</span> <span class="nf">save_editted_paramlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_widget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves edits of parameter linelist in notebook        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_linelist_df</span> <span class="o">=</span> <span class="n">param_widget</span><span class="o">.</span><span class="n">get_changed_df</span><span class="p">()</span>
        <span class="n">param_linelist_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_param_linelist_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">param_linelist_df</span></div></div>
     
<div class="viewcode-block" id="hasNumbers"><a class="viewcode-back" href="../MATS.html#MATS.hasNumbers">[docs]</a><span class="k">def</span> <span class="nf">hasNumbers</span><span class="p">(</span><span class="n">inputString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determines whether there are numbers in a string    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    inputString : str</span>
<span class="sd">        string for analysis</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">inputString</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Fit_DataSet"><a class="viewcode-back" href="../MATS.html#MATS.Fit_DataSet">[docs]</a><span class="k">class</span> <span class="nc">Fit_DataSet</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Provides the fitting functionality for a Dataset.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : object</span>
<span class="sd">            Dataset Object.</span>
<span class="sd">        base_linelist_file : str</span>
<span class="sd">            filename for file containing baseline parameters.</span>
<span class="sd">        param_linelist_file : TYPE</span>
<span class="sd">            filename for file containing parmeter parameters..</span>
<span class="sd">        minimum_parameter_fit_intensity : float, optional</span>
<span class="sd">            minimum intensity for parameters to be generated for fitting. NOTE: Even if a value is floated in the param_linelist if it is below this threshold then it won&#39;t be a floated.. The default is 1e-27.</span>
<span class="sd">        baseline_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on baseline parameter solutions. The default is False.</span>
<span class="sd">        baseline_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor that the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        pressure_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on pressure solutions. The default is False.</span>
<span class="sd">        pressure_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        temperature_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on temperature solutions. The default is False.</span>
<span class="sd">        temperature_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        molefraction_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on mole fraction solutions. The default is False.</span>
<span class="sd">        molefraction_limit_factor : float, optional</span>
<span class="sd">            DESCRIPTION. The default is 10.</span>
<span class="sd">        etalon_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on etalon solutions. The default is False.</span>
<span class="sd">        etalon_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 50. #phase is constrained to +/- 2pi </span>
<span class="sd">        x_shift_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on x-shift solutions. The default is False.</span>
<span class="sd">        x_shift_limit_magnitude : float, optional</span>
<span class="sd">            The magnitude variables set the +/- range of the variable in cm-1. The default is 0.1.</span>
<span class="sd">        nu_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on line center solutions. The default is False.</span>
<span class="sd">        nu_limit_magnitude : float, optional</span>
<span class="sd">            The magnitude variables set the +/- range of the variable in cm-1. The default is 0.1.</span>
<span class="sd">        sw_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on line intensity solutions. The default is False.</span>
<span class="sd">        sw_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        gamma0_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on collisional half-width solutions. The default is False.</span>
<span class="sd">        gamma0_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        n_gamma0_limit : bool, optional</span>
<span class="sd">            DESCIf True, then impose min/max limits on temperature exponent for half width solutions. The default is True.</span>
<span class="sd">        n_gamma0_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        delta0_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on collisional shift solutions. The default is False.</span>
<span class="sd">        delta0_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        n_delta0_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on temperature exponent of the collisional shift solutions. The default is True.</span>
<span class="sd">        n_delta0_limit_factor : float, optional</span>
<span class="sd">            DESCRIPTION. The default is 10.</span>
<span class="sd">        SD_gamma_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on the aw solutions. The default is False.</span>
<span class="sd">        SD_gamma_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        n_gamma2_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on temperature exponent of the speed-dependent width solutions. The default is True.</span>
<span class="sd">        n_gamma2_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        SD_delta_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on as solutions. The default is True.</span>
<span class="sd">        SD_delta_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        n_delta2_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on temperature exponent of the speed-dependent shift solutions. The default is True.</span>
<span class="sd">        n_delta2_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        nuVC_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on dicke narrowing solutions. The default is False.</span>
<span class="sd">        nuVC_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        n_nuVC_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on temperature exponent of dicke narrowing solutions. The default is True.</span>
<span class="sd">        n_nuVC_limit_factor : float, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is 10.</span>
<span class="sd">        eta_limit : bool, optional</span>
<span class="sd">            If True, then impose min/max limits on correlation parameter solutions.. The default is True.</span>
<span class="sd">        eta_limit_factor : float, optional</span>
<span class="sd">             The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.The default is 10.</span>
<span class="sd">        linemixing_limit : bool, optional</span>
<span class="sd">            The factor variable describes the multiplicative factor the value can vary by min = 1/factor * init_guess, max = factor* init_guess. NOTE: If the init_guess for a parameter is equal to zero, then the limits aren&#39;t imposed because 1) then it would constrain the fit to 0 and 2) LMfit won&#39;t let you set min = max.. The default is False.</span>
<span class="sd">        linemixing_limit_factor : float, optional</span>
<span class="sd">            If True, then impose min/max limits on line-mixing solutions.. The default is 10.</span>

<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">base_linelist_file</span><span class="p">,</span> <span class="n">param_linelist_file</span><span class="p">,</span> <span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="mf">1e-27</span><span class="p">,</span>
                <span class="n">baseline_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">baseline_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">pressure_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pressure_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">temperature_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">temperature_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">molefraction_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">molefraction_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">etalon_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">etalon_limit_factor</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="c1">#phase is constrained to +/- 2pi, </span>
                <span class="n">x_shift_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">x_shift_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> 
                <span class="n">nu_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nu_limit_magnitude</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> 
                <span class="n">sw_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sw_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">gamma0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_gamma0_limit</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n_gamma0_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">delta0_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">delta0_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_delta0_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n_delta0_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">SD_gamma_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">SD_gamma_limit_factor</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_gamma2_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n_gamma2_limit_factor</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">SD_delta_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">SD_delta_limit_factor</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_delta2_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n_delta2_limit_factor</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">nuVC_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nuVC_limit_factor</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_nuVC_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n_nuVC_limit_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                <span class="n">eta_limit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">eta_limit_factor</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">linemixing_limit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linemixing_limit_factor</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_linelist_file</span> <span class="o">=</span> <span class="n">base_linelist_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_linelist_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span><span class="c1">#, index_col = 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_linelist_file</span> <span class="o">=</span> <span class="n">param_linelist_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_linelist_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_parameter_fit_intensity</span> <span class="o">=</span> <span class="n">minimum_parameter_fit_intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_limit</span> <span class="o">=</span> <span class="n">baseline_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_limit_factor</span>  <span class="o">=</span> <span class="n">baseline_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_limit</span> <span class="o">=</span> <span class="n">pressure_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_limit_factor</span> <span class="o">=</span> <span class="n">pressure_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_limit</span> <span class="o">=</span> <span class="n">temperature_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_limit_factor</span> <span class="o">=</span> <span class="n">temperature_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit</span> <span class="o">=</span> <span class="n">etalon_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit_factor</span> <span class="o">=</span> <span class="n">etalon_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molefraction_limit</span> <span class="o">=</span> <span class="n">molefraction_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molefraction_limit_factor</span> <span class="o">=</span> <span class="n">molefraction_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit</span> <span class="o">=</span> <span class="n">etalon_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit_factor</span> <span class="o">=</span> <span class="n">etalon_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_shift_limit</span> <span class="o">=</span> <span class="n">x_shift_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_shift_limit_magnitude</span> <span class="o">=</span> <span class="n">x_shift_limit_magnitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit</span> <span class="o">=</span> <span class="n">nu_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit_magnitude</span> <span class="o">=</span> <span class="n">nu_limit_magnitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit</span> <span class="o">=</span> <span class="n">sw_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit_factor</span> <span class="o">=</span> <span class="n">sw_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit</span> <span class="o">=</span> <span class="n">gamma0_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit_factor</span> <span class="o">=</span> <span class="n">gamma0_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma0_limit</span> <span class="o">=</span> <span class="n">n_gamma0_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma0_limit_factor</span> <span class="o">=</span> <span class="n">n_gamma0_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit</span> <span class="o">=</span> <span class="n">delta0_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit_factor</span><span class="o">=</span> <span class="n">delta0_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_delta0_limit</span> <span class="o">=</span> <span class="n">n_delta0_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_delta0_limit_factor</span> <span class="o">=</span> <span class="n">n_delta0_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit</span> <span class="o">=</span> <span class="n">SD_gamma_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit_factor</span> <span class="o">=</span> <span class="n">SD_gamma_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma2_limit</span> <span class="o">=</span> <span class="n">n_gamma2_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma2_limit_factor</span> <span class="o">=</span> <span class="n">n_gamma2_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit</span> <span class="o">=</span> <span class="n">SD_gamma_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit_factor</span> <span class="o">=</span> <span class="n">SD_delta_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_delta2_limit</span> <span class="o">=</span> <span class="n">n_delta2_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_delta2_limit_factor</span> <span class="o">=</span> <span class="n">n_delta2_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit</span> <span class="o">=</span> <span class="n">nuVC_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit_factor</span> <span class="o">=</span> <span class="n">nuVC_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_nuVC_limit</span> <span class="o">=</span> <span class="n">n_nuVC_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_nuVC_limit_factor</span> <span class="o">=</span> <span class="n">n_nuVC_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_limit</span> <span class="o">=</span> <span class="n">eta_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_limit_factor</span> <span class="o">=</span> <span class="n">eta_limit_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit</span> <span class="o">=</span> <span class="n">linemixing_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit_factor</span> <span class="o">=</span> <span class="n">linemixing_limit_factor</span>
        
<div class="viewcode-block" id="Fit_DataSet.generate_params"><a class="viewcode-back" href="../MATS.html#MATS.Fit_DataSet.generate_params">[docs]</a>    <span class="k">def</span> <span class="nf">generate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the lmfit parameter object that will be used in fitting.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        params : lmfit parameter object</span>
<span class="sd">            the parameter object is a dictionary comprised of all parameters translated from dataframes into a dictionary format compatible with lmfit</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
        <span class="c1">#Baseline Parameters</span>
        <span class="n">baseline_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">base_param</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_vary&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;_err&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Spectrum Number&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Segment Number&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">):</span>
                <span class="n">baseline_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_param</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">spec_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span>
            <span class="n">seg_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">base_param</span> <span class="ow">in</span> <span class="n">baseline_parameters</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;Pressure&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure_limit</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                              <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> 
                              <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;Temperature&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature_limit</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                              <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> 
                              <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;molefraction&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">molefraction_limit</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                              <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">molefraction_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> 
                              <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molefraction_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_limit</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                              <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> 
                              <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_limit_factor</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;etalon_&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;phase&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">):</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                              <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit_factor</span> <span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> 
                              <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit_factor</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;etalon_&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">etalon_limit</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;phase&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">):</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                              <span class="nb">min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;x_shift&#39;</span> <span class="ow">in</span> <span class="n">base_param</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_shift_limit</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                              <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_shift_limit_magnitude</span><span class="p">),</span> 
                              <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_shift_limit_magnitude</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">])</span>   
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_num</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">base_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
        
        <span class="c1">#Lineshape parameters</span>
        <span class="n">linelist_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line_param</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_number_nominal_temperatures</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_vary&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;_err&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;molec_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;local_iso_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;elower&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;n_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">):</span>
                    <span class="n">linelist_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_param</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_vary&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;_err&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;molec_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;local_iso_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;elower&#39;</span><span class="p">):</span>
                    <span class="n">linelist_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_param</span><span class="p">)</span>
        <span class="n">diluent_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">diluent</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">Diluent</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">diluent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">diluent_list</span><span class="p">:</span>
                    <span class="n">diluent_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diluent</span><span class="p">)</span>
        <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">SD_gamma_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">SD_delta_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">eta_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">linemix_constrain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">sum</span><span class="p">((</span><span class="s1">&#39;nu&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="s1">&#39;nuVC&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nu_constrain</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;sw&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">sw_constrain</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_number_nominal_temperatures</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;gamma0&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;delta0&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">SD_gamma_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;SD_delta&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">SD_delta_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;nuVC&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;eta&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">eta_constrain</span> <span class="o">=</span> <span class="kc">False</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;gamma0&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">gamma0_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;delta0&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">delta0_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">SD_gamma_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;SD_delta&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">SD_delta_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;nuVC&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">nuVC_constrain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;eta&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">):</span>
                <span class="n">eta_constrain</span> <span class="o">=</span> <span class="kc">False</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">))</span> <span class="o">&gt;</span>  <span class="nb">len</span><span class="p">(</span><span class="n">diluent_list</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_number_nominal_temperatures</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">linemix_constrain</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">linemix_terms_constrained</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">diluent</span> <span class="ow">in</span> <span class="n">diluent_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">temperature</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_number_nominal_temperatures</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">linemix_terms_constrained</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="n">diluent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">spec_line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum_parameter_fit_intensity</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="s1">&#39;sw_scale_factor&#39;</span><span class="p">]:</span><span class="c1"># bigger than 1 because fit_intensity / fit_intensity</span>
                <span class="k">for</span> <span class="n">line_param</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">:</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">line_param</span><span class="p">)]</span>
                    <span class="n">index_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
                    <span class="c1">#NU</span>
                    <span class="k">if</span> <span class="n">line_param</span> <span class="o">==</span> <span class="s1">&#39;nu&#39;</span> <span class="ow">and</span> <span class="n">nu_constrain</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                      <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit_magnitude</span><span class="p">,</span> 
                                      <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit_magnitude</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;nu&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;nu&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;nuVC&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">nu_constrain</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                      <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit_magnitude</span><span class="p">,</span> 
                                      <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu_limit_magnitude</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="c1">#SW</span>
                    <span class="k">elif</span> <span class="n">line_param</span> <span class="o">==</span> <span class="s1">&#39;sw&#39;</span> <span class="ow">and</span> <span class="n">sw_constrain</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit_factor</span><span class="p">)</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit_factor</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;sw&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;sw&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">sw_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="o">!=</span> <span class="s1">&#39;sw_scale_factor&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit_factor</span><span class="p">)</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span>
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="c1">#GAMMA0</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;gamma0_&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;n_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">gamma0_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">]</span> <span class="p">,</span><span class="c1">#(1 - (self.gamma0_limit_percent / 100))*lineparam_list.loc[int(spec_line)][line_param], </span>
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span><span class="c1">#(1 + (self.gamma0_limit_percent / 100))*lineparam_list.loc[int(spec_line)][line_param])</span>
                                
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;gamma0_&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;n_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">gamma0_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span><span class="c1">#(1 - (self.gamma0_limit_percent / 100))*lineparam_list.loc[int(spec_line)][line_param], </span>
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma0_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span><span class="c1">#(1 + (self.gamma0_limit_percent / 100))*lineparam_list.loc[int(spec_line)][line_param])</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;n_gamma0&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma0_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma0_limit_factor</span><span class="p">)</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma0_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="c1">#DELTA0</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;delta0&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;n_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">delta0_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit_factor</span> <span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;delta0_&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;n_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">delta0_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta0_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;n_delta0&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_delta0_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_delta0_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_delta0_limit_factor</span> <span class="o">/</span> <span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="c1">#SD Gamma</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SD_gamma_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit_factor</span><span class="p">)</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span>
                            <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;SD_gamma&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">SD_gamma_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_gamma_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;n_gamma2&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">):</span>
                    
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma2_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gamma2_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                <span class="nb">max</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gamma2_limit_factor</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="c1">#SD Delta</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;SD_delta&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SD_delta_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit_factor</span> <span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;SD_delta&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">SD_delta_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit_factor</span> <span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SD_delta_limit_factor</span> <span class="o">/</span> <span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;n_delta2&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">):</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_delta2_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_delta2_limit_factor</span> <span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_delta2_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="c1">#nuVC</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;nuVC&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;n_nuVC_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nuVC_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;nuVC&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;n_nuVC&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">nuVC_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuVC_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;n_nuVC&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nuVC_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nuVC_limit_factor</span> <span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nuVC_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>                    
                    <span class="c1">#eta</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;eta_&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">eta_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;eta_&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">eta_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index_length</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_limit_factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span> 
                    <span class="c1"># linemixing</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">linemix_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line_param</span> <span class="ow">in</span> <span class="n">linemix_terms_constrained</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit_factor</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="ow">in</span> <span class="n">line_param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">linemix_constrain</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">line_param</span> <span class="ow">in</span> <span class="n">linemix_terms_constrained</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">],</span> 
                                  <span class="nb">min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit_factor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">],</span> 
                                  <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linemixing_limit_factor</span> <span class="o">/</span> <span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_line</span><span class="p">)][</span><span class="n">line_param</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;line_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec_line</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec_line</span><span class="p">][</span><span class="n">line_param</span> <span class="o">+</span> <span class="s1">&#39;_vary&#39;</span><span class="p">])</span> 
        <span class="k">return</span> <span class="p">(</span><span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fit_DataSet.constrained_baseline"><a class="viewcode-back" href="../MATS.html#MATS.Fit_DataSet.constrained_baseline">[docs]</a>    <span class="k">def</span> <span class="nf">constrained_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">baseline_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">xshift_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">molefraction_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                    <span class="n">etalon_amp_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">etalon_freq_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">etalon_phase_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">pressure_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">temperature_segment_constrained</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Imposes baseline constraints when using multiple segments per spectrum, ie all baseline parameters can be the same across the entire spectrum except for the etalon phase, which is allowed to vary per segment.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : lmfit parameter object</span>
<span class="sd">            the params object is a dictionary comprised of all parameters translated from dataframes into a dictionary format compatible with lmfit.</span>
<span class="sd">        baseline_segment_constrained : bool, optional</span>
<span class="sd">            True means the baseline terms are constrained across each spectrum.. The default is True.</span>
<span class="sd">        xshift_segment_constrained : bool, optional</span>
<span class="sd">            True means the x_shift terms are constrained across each spectrum.. The default is True.</span>
<span class="sd">        molefraction_segment_constrained : bool, optional</span>
<span class="sd">            True means the mole fraction for that molecule is constrained across each spectrum.. The default is True.</span>
<span class="sd">        etalon_amp_segment_constrained : bool, optional</span>
<span class="sd">            True means the etalon amplitude is constrained across each spectrum.. The default is True.</span>
<span class="sd">        etalon_freq_segment_constrained : bool, optional</span>
<span class="sd">            True means the etalon frequency is constrained across each spectrum.. The default is True.</span>
<span class="sd">        etalon_phase_segment_constrained : bool, optional</span>
<span class="sd">            True means the etalon phase is constrained across each spectrum.. The default is True.</span>
<span class="sd">        pressure_segment_constrained : bool, optional</span>
<span class="sd">            True means the pressure is constrained across each spectrum.. The default is True.</span>
<span class="sd">        temperature_segment_constrained : bool, optional</span>
<span class="sd">            True means the temperature is constrained across each spectrum.. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        params : lmfit parameter object</span>
<span class="sd">            the params object is a dictionary comprised of all parameters translated from dataframes into a dictionary format compatible with lmfit.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spectrum_segment_min</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">segments</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Pressure&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pressure_segment_constrained</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)]</span>
                <span class="n">spectrum_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">segment_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;Temperature&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="n">temperature_segment_constrained</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)]</span>
                <span class="n">spectrum_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">segment_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
            
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="n">baseline_segment_constrained</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)]</span>
                <span class="n">spectrum_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">segment_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">segment_num</span> <span class="o">!=</span> <span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;x_shift&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="n">xshift_segment_constrained</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)]</span>
                <span class="n">spectrum_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">segment_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">segment_num</span> <span class="o">!=</span> <span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;molefraction&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="n">molefraction_segment_constrained</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)]</span>
                <span class="n">spectrum_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">segment_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">segment_num</span> <span class="o">!=</span> <span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;etalon&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)]</span>
                <span class="n">spectrum_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
                <span class="n">segment_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="s1">&#39;amp&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="ow">and</span> <span class="n">etalon_amp_segment_constrained</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">segment_num</span> <span class="o">!=</span> <span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]:</span>
                        <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="ow">and</span> <span class="n">etalon_freq_segment_constrained</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">segment_num</span> <span class="o">!=</span> <span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]:</span>
                        <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="s1">&#39;phase&#39;</span> <span class="ow">in</span> <span class="n">param</span> <span class="ow">and</span> <span class="n">etalon_phase_segment_constrained</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">segment_num</span> <span class="o">!=</span> <span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]:</span>
                        <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_segment_min</span><span class="p">[</span><span class="n">spectrum_num</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="Fit_DataSet.simulation_model"><a class="viewcode-back" href="../MATS.html#MATS.Fit_DataSet.simulation_model">[docs]</a>    <span class="k">def</span> <span class="nf">simulation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">wing_wavenumbers</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is the model used for fitting that includes baseline and resonant absorption models.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : lmfit parameter object</span>
<span class="sd">            the params object is a dictionary comprised of all parameters translated from dataframes into a dictionary format compatible with lmfit.</span>
<span class="sd">        wing_cutoff : float, optional</span>
<span class="sd">            number of voigt half-widths to simulate on either side of each line. The default is 50.</span>
<span class="sd">        wing_wavenumbers : float, optional</span>
<span class="sd">            number of wavenumbers to simulate on either side of each line. The default is 50.</span>
<span class="sd">        wing_method : TYPE, optional</span>
<span class="sd">            Provides choice between the wing_cutoff and wing_wavenumbers line cut-off options. The default is &#39;wing_cutoff&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        total_residuals : array</span>
<span class="sd">            residuals for all spectra in Dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_simulated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_residuals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">baseline_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">linelist_params</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Set-up Baseline Parameters</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">valuesdict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;molefraction&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;etalon&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;x_shift&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;Pressure&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;Temperature&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">):</span>
                <span class="n">baseline_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linelist_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">simulated_spectra</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    
            <span class="n">residuals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>        
            <span class="n">wavenumber_segments</span><span class="p">,</span> <span class="n">alpha_segments</span><span class="p">,</span> <span class="n">indices_segments</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">segment_wave_alpha</span><span class="p">()</span>
            <span class="n">Diluent</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">Diluent</span>
            <span class="n">spectrum_number</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span>
            <span class="n">nominal_temp</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">nominal_temperature</span>          
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;molec_id&#39;</span><span class="p">,</span> <span class="s1">&#39;local_iso_id&#39;</span><span class="p">,</span> <span class="s1">&#39;elower&#39;</span><span class="p">,</span> <span class="s1">&#39;nu&#39;</span><span class="p">,</span> <span class="s1">&#39;sw&#39;</span><span class="p">,</span> <span class="s1">&#39;sw_scale_factor&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">Diluent</span><span class="p">:</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;gamma0_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_gamma0_&#39;</span><span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;delta0_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_delta0_&#39;</span><span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_gamma_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_gamma2_&#39;</span><span class="o">+</span> <span class="n">species</span> <span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;SD_delta_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_delta2_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuVC_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;n_nuVC_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;eta_&#39;</span> <span class="o">+</span> <span class="n">species</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="o">+</span> <span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">))</span>
            <span class="n">rename_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;vary&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;err&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">))</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column</span><span class="p">):</span>
                        <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">))</span><span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">column</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
                        <span class="n">rename_dictionary</span><span class="p">[(</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">))]</span> <span class="o">=</span> <span class="n">column</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;y_&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">))</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="p">):</span>
                            <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>  <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">))</span><span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">column</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
                            <span class="n">rename_dictionary</span><span class="p">[(</span><span class="n">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">column</span><span class="p">[:</span><span class="n">column</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">rename_dictionary</span><span class="p">[(</span><span class="n">column</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">column</span><span class="p">[:</span><span class="n">column</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nominal_temp</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">linelist_for_sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
           
            <span class="c1"># Replaces the relevant linelist locations with the </span>
            <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">linelist_params</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameter</span><span class="p">[</span><span class="n">parameter</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_line_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span><span class="p">:])</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[:</span><span class="n">parameter</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_line_&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;sw&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                        <span class="c1">#print (linelist_for_sim[line][&#39;sw_scale_factor&#39;])</span>
                        <span class="n">linelist_for_sim</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">parameter</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">linelist_for_sim</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">parameter</span><span class="p">])</span>
            <span class="c1">#Renames columns to generic (no scan number)</span>
            <span class="n">linelist_for_sim</span><span class="o">=</span><span class="n">linelist_for_sim</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">rename_dictionary</span><span class="p">)</span> 
            <span class="n">linelist_for_sim</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linelist_for_sim</span><span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">linelist_for_sim</span><span class="p">[</span><span class="s1">&#39;sw_scale_factor&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">segments</span><span class="p">)):</span>
                <span class="n">wavenumbers</span> <span class="o">=</span> <span class="n">wavenumber_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span>
                <span class="n">wavenumbers_relative</span> <span class="o">=</span> <span class="n">wavenumbers</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span>
                <span class="n">x_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x_shift_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">)])</span>
                <span class="c1">#linelist_for_sim[&#39;nu&#39;] = linelist_for_sim[&#39;nu&#39;] + x_shift # Q</span>
                <span class="n">wavenumbers</span> <span class="o">+=</span> <span class="n">x_shift</span>
                <span class="n">wavenumbers_relative</span><span class="o">+=</span> <span class="n">x_shift</span>
                <span class="c1">#Set-up MoleFraction for Fitting</span>
                <span class="n">fit_molefraction</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">molefraction</span>
                <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">molefraction</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;molefraction_&#39;</span><span class="o">+</span> <span class="n">ISO</span><span class="p">[(</span><span class="n">molecule</span><span class="p">,</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="ow">in</span> <span class="n">baseline_params</span><span class="p">:</span>
                        <span class="n">fit_molefraction</span><span class="p">[</span><span class="n">molecule</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[(</span><span class="s1">&#39;molefraction_&#39;</span><span class="o">+</span> <span class="n">ISO</span><span class="p">[(</span><span class="n">molecule</span><span class="p">,</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">)])</span>
                <span class="c1">#Get Environmental Parameters</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Pressure_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">)])</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Temperature_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">)])</span>               
                <span class="c1">#Simulate Spectra</span>
                <span class="n">fit_nu</span><span class="p">,</span> <span class="n">fit_coef</span> <span class="o">=</span> <span class="n">HTP_from_DF_select</span><span class="p">(</span><span class="n">linelist_for_sim</span><span class="p">,</span> <span class="n">wavenumbers</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="n">wing_cutoff</span><span class="p">,</span> <span class="n">wing_wavenumbers</span> <span class="o">=</span> <span class="n">wing_wavenumbers</span><span class="p">,</span> <span class="n">wing_method</span> <span class="o">=</span> <span class="n">wing_method</span><span class="p">,</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="p">,</span> <span class="n">molefraction</span> <span class="o">=</span> <span class="n">fit_molefraction</span><span class="p">,</span> 
                        <span class="n">natural_abundance</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">natural_abundance</span><span class="p">,</span> <span class="n">abundance_ratio_MI</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">abundance_ratio_MI</span><span class="p">,</span>  <span class="n">Diluent</span> <span class="o">=</span> <span class="n">Diluent</span><span class="p">)</span>
                <span class="n">fit_coef</span> <span class="o">=</span> <span class="n">fit_coef</span> <span class="o">*</span> <span class="mf">1e6</span>
                <span class="c1">## Baseline Calculation</span>
                <span class="n">baseline_param_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">baseline_order</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">baseline_params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">):</span>
                        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)]</span>
                        <span class="n">spectrum_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                        <span class="n">segment_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">spectrum_num</span> <span class="o">==</span> <span class="n">spectrum_number</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">segment_num</span> <span class="o">==</span> <span class="n">segment</span><span class="p">):</span> 
                            <span class="n">baseline_param_array</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">)])</span><span class="o">-</span><span class="mi">97</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                <span class="n">baseline_param_array</span> <span class="o">=</span> <span class="n">baseline_param_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># reverses array to be used for polyval</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">baseline_param_array</span><span class="p">,</span> <span class="n">wavenumbers_relative</span><span class="p">)</span>
                <span class="c1">#Etalon Calculation</span>
                <span class="n">fit_etalon_parameters</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;amp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">baseline_params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;etalon&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">):]):</span>
                        <span class="n">etalon_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;etalon_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">etalon_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_amp_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">):</span><span class="c1">#(&#39;amp&#39; in param) and (str(etalon_num) in param):</span>
                            <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">etalon_num</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;etalon_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">etalon_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_freq_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">):</span><span class="c1">#(&#39;freq&#39; in param) and (str(etalon_num) in param):</span>
                            <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">etalon_num</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;etalon_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">etalon_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_phase_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">segment</span><span class="p">):</span><span class="c1">#(&#39;phase&#39; in param) and (str(etalon_num) in param):</span>
                            <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">etalon_num</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                <span class="n">etalons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavenumbers</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">etalons</span> <span class="o">+=</span> <span class="n">etalon</span><span class="p">(</span><span class="n">wavenumbers_relative</span><span class="p">,</span> <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">],</span> <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">])</span> 
                <span class="n">simulated_spectra</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">indices_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]):</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">indices_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">baseline</span> <span class="o">+</span> <span class="n">etalons</span> <span class="o">+</span> <span class="n">fit_coef</span><span class="p">)</span>
                <span class="n">residuals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">indices_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]):</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">indices_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">baseline</span> <span class="o">+</span> <span class="n">etalons</span> <span class="o">+</span> <span class="n">fit_coef</span><span class="p">)</span> <span class="o">-</span> <span class="n">alpha_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span>
            <span class="n">total_simulated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_simulated</span><span class="p">,</span> <span class="n">simulated_spectra</span><span class="p">)</span>
            <span class="n">total_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_residuals</span><span class="p">,</span> <span class="n">residuals</span><span class="p">)</span>
        <span class="n">total_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">total_residuals</span><span class="p">)</span>
        <span class="n">total_simulated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">total_simulated</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total_residuals</span></div>
<div class="viewcode-block" id="Fit_DataSet.fit_data"><a class="viewcode-back" href="../MATS.html#MATS.Fit_DataSet.fit_data">[docs]</a>    <span class="k">def</span> <span class="nf">fit_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">wing_cutoff</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">wing_wavenumbers</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">wing_method</span> <span class="o">=</span> <span class="s1">&#39;wing_cutoff&#39;</span><span class="p">,</span> <span class="n">xtol</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="n">maxfev</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">ftol</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses the lmfit minimizer to do the fitting through the simulation model function.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : lmfit parameter object</span>
<span class="sd">            the params object is a dictionary comprised of all parameters translated from dataframes into a dictionary format compatible with lmfit.</span>
<span class="sd">        wing_cutoff : float, optional</span>
<span class="sd">            number of voigt half-widths to simulate on either side of each line. The default is 50.</span>
<span class="sd">        wing_wavenumbers : float, optional</span>
<span class="sd">            number of wavenumbers to simulate on either side of each line. The default is 50.</span>
<span class="sd">        wing_method : str, optional</span>
<span class="sd">            Provides choice between the wing_cutoff and wing_wavenumbers line cut-off options. The default is &#39;wing_cutoff&#39;.</span>
<span class="sd">        xtol : float, optional</span>
<span class="sd">             Absolute error in xopt between iterations that is acceptable for convergence. The default is 1e-7.</span>
<span class="sd">        maxfev : float, optional</span>
<span class="sd">            DESCRIPTION. The default is 2000.</span>
<span class="sd">        ftol : The maximum number of calls to the function., optional</span>
<span class="sd">            Absolute error in func(xopt) between iterations that is acceptable for convergence.. The default is 1e-7.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : LMFit result Object</span>
<span class="sd">            contains all fit results as LMFit results object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">minner</span> <span class="o">=</span> <span class="n">Minimizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">xtol</span> <span class="o">=</span><span class="n">xtol</span><span class="p">,</span> <span class="n">maxfev</span> <span class="o">=</span>  <span class="n">maxfev</span><span class="p">,</span> <span class="n">ftol</span> <span class="o">=</span> <span class="n">ftol</span><span class="p">,</span> <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span><span class="n">wing_cutoff</span><span class="p">,</span> <span class="n">wing_wavenumbers</span><span class="p">,</span> <span class="n">wing_method</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minner</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;leastsq&#39;</span><span class="p">)</span><span class="c1">#&#39;</span>
        <span class="k">return</span> <span class="n">result</span></div>
<div class="viewcode-block" id="Fit_DataSet.residual_analysis"><a class="viewcode-back" href="../MATS.html#MATS.Fit_DataSet.residual_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">residual_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">indv_resid_plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the model and residual arrays in each spectrum object with the results of the fit and gives the option of generating the combined absorption and residual plot for each spectrum.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        result : LMFit result Object</span>
<span class="sd">            contains all fit results as LMFit results object.</span>
<span class="sd">        indv_resid_plot : bool, optional</span>
<span class="sd">            True if you want to show residual plots for each spectra.. The default is False.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">residual_array</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">residual</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spectrum_residual</span><span class="p">,</span> <span class="n">residual_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">residual_array</span><span class="p">,</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)])</span>
            <span class="n">spectrum</span><span class="o">.</span><span class="n">set_residuals</span><span class="p">(</span><span class="n">spectrum_residual</span><span class="p">)</span>
            <span class="n">spectrum</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">spectrum_residual</span> <span class="o">+</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">indv_resid_plot</span><span class="p">:</span>
                <span class="n">spectrum</span><span class="o">.</span><span class="n">plot_model_residuals</span><span class="p">()</span></div>
<div class="viewcode-block" id="Fit_DataSet.update_params"><a class="viewcode-back" href="../MATS.html#MATS.Fit_DataSet.update_params">[docs]</a>    <span class="k">def</span> <span class="nf">update_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">base_linelist_update_file</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">param_linelist_update_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the baseline and line parameter files based on fit results with the option to write over the file (default) or save as a new file. </span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        result : LMFit result Object</span>
<span class="sd">            contains all fit results as LMFit results object.</span>
<span class="sd">        base_linelist_update_file : str, optional</span>
<span class="sd">            Name of file to save the updated baseline parameters. Default is to override the input. The default is None.</span>
<span class="sd">        param_linelist_update_file : str, optional</span>
<span class="sd">            Name of file to save the updated line parameters. Default is to override the input. The default is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">base_linelist_update_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_linelist_update_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_linelist_file</span>
        <span class="k">if</span> <span class="n">param_linelist_update_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param_linelist_update_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_linelist_file</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Pressure&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;Temperature&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">spectrum</span><span class="p">),</span> <span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">spectrum</span><span class="p">),</span> <span class="n">parameter</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">stderr</span>
                
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;molefraction&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;x_shift&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">spectrum</span><span class="p">),</span> <span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">spectrum</span><span class="p">),</span> <span class="n">parameter</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">stderr</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;etalon&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indices</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">spectrum</span><span class="p">),</span> <span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Segment Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="p">[</span><span class="s1">&#39;Spectrum Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">spectrum</span><span class="p">),</span> <span class="n">parameter</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">stderr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_line&#39;</span><span class="p">)]</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_line&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">parameter</span> <span class="o">+</span> <span class="s1">&#39;_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">stderr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_list</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">base_linelist_update_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineparam_list</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">param_linelist_update_file</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="c1">#Calculate Baseline + Etalons and add to the Baseline term for each spectra</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">wavenumber_segments</span><span class="p">,</span> <span class="n">alpha_segments</span><span class="p">,</span> <span class="n">indices_segments</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">segment_wave_alpha</span><span class="p">()</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">segments</span><span class="p">):</span>
                <span class="n">waves</span> <span class="o">=</span> <span class="n">wavenumber_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span>
                <span class="n">bound_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">indices_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
                <span class="n">bound_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">indices_segments</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
                <span class="n">wave_rel</span> <span class="o">=</span> <span class="n">waves</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">wavenumber</span><span class="p">)</span>
                <span class="n">baseline_param_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">baseline_order</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">fit_etalon_parameters</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;amp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">baseline_param_array</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">)])</span><span class="o">-</span><span class="mi">97</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;etalon&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectrum_number</span><span class="p">)</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">):]):</span>
                        <span class="n">etalon_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;amp&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">etalon_num</span><span class="p">)</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                            <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">etalon_num</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;freq&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">etalon_num</span><span class="p">)</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                            <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">etalon_num</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;phase&#39;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">etalon_num</span><span class="p">)</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                            <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">etalon_num</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span>
                <span class="n">baseline_param_array</span> <span class="o">=</span> <span class="n">baseline_param_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># reverses array to be used for polyval</span>
                <span class="n">baseline</span><span class="p">[</span><span class="n">bound_min</span><span class="p">:</span> <span class="n">bound_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">baseline_param_array</span><span class="p">,</span> <span class="n">wave_rel</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">etalons</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">baseline</span><span class="p">[</span><span class="n">bound_min</span><span class="p">:</span> <span class="n">bound_max</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">etalon</span><span class="p">(</span><span class="n">wave_rel</span><span class="p">,</span> <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">],</span> <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">fit_etalon_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">])</span>
            <span class="n">spectrum</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MATS 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MATS</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.1.
    </div>
  </body>
</html>